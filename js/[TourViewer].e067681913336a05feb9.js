(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{621:function(e,t,i){"use strict";i.r(t),i.d(t,"Editor",(function(){return g})),i.d(t,"TourTitleWrapper",(function(){return w})),i.d(t,"GenericIcon",(function(){return b})),i.d(t,"GenericWrapper",(function(){return v})),i.d(t,"Image",(function(){return y})),i.d(t,"ControlContainer",(function(){return x})),i.d(t,"ActionsWrapper",(function(){return C})),i.d(t,"DeleteAction",(function(){return I})),i.d(t,"DownloadAction",(function(){return S})),i.d(t,"SwapAction",(function(){return E})),i.d(t,"LinkWrapper",(function(){return _})),i.d(t,"ExpandAction",(function(){return T})),i.d(t,"EditAction",(function(){return O})),i.d(t,"Link",(function(){return N})),i.d(t,"GenericAction",(function(){return P})),i.d(t,"ActionIcon",(function(){return R})),i.d(t,"ExpandIcon",(function(){return A})),i.d(t,"Progress",(function(){return V})),i.d(t,"Wrapper",(function(){return j})),i.d(t,"Button",(function(){return D})),i.d(t,"TextField",(function(){return L})),i.d(t,"ErrorText",(function(){return H})),i.d(t,"Stack",(function(){return z})),i.d(t,"Line",(function(){return F})),i.d(t,"LeaderImage",(function(){return M})),i.d(t,"Header",(function(){return U})),i.d(t,"Leader",(function(){return W})),i.d(t,"FeatureListContainer",(function(){return B})),i.d(t,"FeatureListText",(function(){return q})),i.d(t,"FeatureList",(function(){return J})),i.d(t,"FeatureListItem",(function(){return K})),i.d(t,"FeatureItemIcon",(function(){return G})),i.d(t,"FeatureItemText",(function(){return Y}));var n=i(3),o=i.n(n),a=i(65),r=i(135),s=i(679),c=i.n(s),l=i(762),d=i.n(l),p=i(763),u=i.n(p),m=i(764),h=i.n(m),f=i(614),g=a.default.div.withConfig({displayName:"UI__Editor",componentId:"sc-1tbuii0-0"})(["-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;border-right:0.1em solid #1CA59B;border-left:0.1em solid #1CA59B;align-items:flex-start;align-content:baseline;justify-content:center;flex-direction:column;overflow-y:scroll;overflow-x:hidden;border-bottom:0.1em solid ",";@media screen and (max-width:","){padding:1em;max-width:100%;}@media screen and (max-height:","){}::-webkit-scrollbar{width:0 !important;}"],f.actionColor,f.mobilePortraitWidth,f.mobileLandscapeHeight),w=a.default.div.withConfig({displayName:"UI__TourTitleWrapper",componentId:"sc-1tbuii0-1"})(["padding-left:45%;padding-bottom:1em;"]),b=Object(a.default)(r.a).withConfig({displayName:"UI__GenericIcon",componentId:"sc-1tbuii0-2"})(["cursor:pointer;color:",";&:active{color:",";}"],f.actionColor,f.actionActiveColor),v=a.default.div.withConfig({displayName:"UI__GenericWrapper",componentId:"sc-1tbuii0-3"})(["padding-left:0.4em;@media screen and (max-width:","){padding-left:0;}"],f.mobilePortraitWidth),y=a.default.img.withConfig({displayName:"UI__Image",componentId:"sc-1tbuii0-4"})(["margin:0.6em;margin-top:0;max-width:10em;border-radius:0.2em;cursor:pointer;@media screen and (max-width:","){max-width:100%;margin:0;}"],f.mobilePortraitWidth),x=a.default.div.withConfig({displayName:"UI__ControlContainer",componentId:"sc-1tbuii0-5"})(["position:absolute;top:1em;left:50%;background:white;padding:0.4em;border-radius:0.2em;color:#3e8aef;&:active{color:darkblue;}"]),C=a.default.div.withConfig({displayName:"UI__ActionsWrapper",componentId:"sc-1tbuii0-6"})(["position:absolute;"," background:white;display:flex;border-radius:0.2em;box-shadow:0.01em 0.01em 0.01em 0.08em lightgray;","  "," @media screen and (max-width:30em){right:15%;}"],(function(e){return e.relative?"position: relative;":"position: absolute;"}),(function(e){return e.positionTemp?e.positionTemp:"top: 0.2em;\n  right: 1em;\n  "}),(function(e){return e.position})),I=function(e){return o.a.createElement(k,{styles:e.styles,onClick:e.onClick,noBorder:!0},o.a.createElement(R,{icon:u.a}))},S=function(e){return o.a.createElement(k,{styles:e.styles,onClick:e.onClick,noBorder:!0},o.a.createElement(R,{icon:h.a}))},E=function(e){return o.a.createElement(k,{styles:e.styles,noBorder:!0},o.a.createElement(R,{icon:e.icon}))},k=a.default.div.withConfig({displayName:"UI__IconWrapper",componentId:"sc-1tbuii0-7"})(["color:",";display:inline-block;text-align:center;cursor:pointer;",";"],f.actionColor,(function(e){return e.styles})),_=a.default.div.withConfig({displayName:"UI__LinkWrapper",componentId:"sc-1tbuii0-8"})(["margin:0.4em;padding:0.2em;border-radius:0.2em;box-shadow:0.01em 0.01em 0.01em 0.08em lightgray;width:8em;text-align:center;&:active{box-shadow:0.01em 0.01em 0.01em 0.04em black;transform:translateY(0.1em);}"]),T=function(e){return o.a.createElement(k,{onClick:e.onClick,noBorder:e.noBorder},o.a.createElement(A,{icon:c.a}))},O=function(e){return o.a.createElement(k,{styles:e.styles,onClick:e.onClick,noBorder:e.noBorder},o.a.createElement(A,{color:e.color,icon:d.a}))},N=a.default.a.withConfig({displayName:"UI__Link",componentId:"sc-1tbuii0-9"})(["color:",";&:active{color:",";}"],f.actionColor,f.actionActiveColor),P=function(e){return o.a.createElement(k,{onClick:e.onClick,large:e.large,noBorder:e.noBorder},o.a.createElement("a",null,e.text))},R=Object(a.default)(r.a).withConfig({displayName:"UI__ActionIcon",componentId:"sc-1tbuii0-10"})(["color:white;&:active{color:",";}"],f.actionActiveColor),A=Object(a.default)(r.a).withConfig({displayName:"UI__ExpandIcon",componentId:"sc-1tbuii0-11"})(["cursor:pointer;color:",";&:active{color:",";}"],(function(e){return e.color||f.actionColor}),f.actionActiveColor),V=a.default.div.withConfig({displayName:"UI__Progress",componentId:"sc-1tbuii0-12"})(["position:absolute;top:0;left:50%;margin-top:1em;"]),j=a.default.div.withConfig({displayName:"UI__Wrapper",componentId:"sc-1tbuii0-13"})(["height:100%;width:100%;overflow:none;display:block;position:fixed;"]),D=a.default.button.withConfig({displayName:"UI__Button",componentId:"sc-1tbuii0-14"})(["-webkit-appearance:none;-moz-appearance:none;appearance:none;color:white;background:",";border:none;border-radius:5px;font-size:.9em;text-align:center;width:100%;margin:.3em 0;padding:.7em .8em;cursor:pointer;transition:500ms;&:hover{background:",";color:white;cursor:pointer;}",";"],(function(e){return e.disabled?"grey":"#57c1ca"}),(function(e){return e.disabled?"grey":"#61d6df"}),(function(e){return e.styles})),L=a.default.input.withConfig({displayName:"UI__TextField",componentId:"sc-1tbuii0-15"})(["border-color:",";font-size:.9em;text-align:center;width:100%;margin:.3em 0;padding:.7em .8em;"],(function(e){return e.error?"red":"inherit"})),H=a.default.span.withConfig({displayName:"UI__ErrorText",componentId:"sc-1tbuii0-16"})(["color:red;text-align:center;display:block;font-size:14px;"]),z=a.default.div.withConfig({displayName:"UI__Stack",componentId:"sc-1tbuii0-17"})([""]),F=a.default.div.withConfig({displayName:"UI__Line",componentId:"sc-1tbuii0-18"})(["width:100%;height:1px;background:",";margin:1.5em 0;"],(function(e){return e.hidden?"transparent":"grey"})),M=a.default.img.withConfig({displayName:"UI__LeaderImage",componentId:"sc-1tbuii0-19"})(["border-radius:50%;width:150px;height:150px;object-fit:cover;"]),U=a.default.h3.withConfig({displayName:"UI__Header",componentId:"sc-1tbuii0-20"})(["color:white;width:100%;text-shadow:black 1px 1px 20px;text-align:left;"]),W=Object(a.default)(f.Horizontal).withConfig({displayName:"UI__Leader",componentId:"sc-1tbuii0-21"})(["background:linear-gradient(90deg,#00c4cc,#7d2ae8);border-radius:10px;margin-bottom:20px;padding:10px;box-shadow:0px 3px 4px 0px black;cursor:pointer;height:170px;font-size:1.2rem;"]),B=a.default.div.withConfig({displayName:"UI__FeatureListContainer",componentId:"sc-1tbuii0-22"})([""]),q=a.default.p.withConfig({displayName:"UI__FeatureListText",componentId:"sc-1tbuii0-23"})(["font-size:0.8em;color:white;margin:0;text-align:left;"]),J=a.default.ul.withConfig({displayName:"UI__FeatureList",componentId:"sc-1tbuii0-24"})(["position:relative;list-style-type:none;text-align:left;line-height:1.4em;padding:0;"]),K=a.default.li.withConfig({displayName:"UI__FeatureListItem",componentId:"sc-1tbuii0-25"})(["display:flex;margin-top:15px;"]),G=a.default.span.withConfig({displayName:"UI__FeatureItemIcon",componentId:"sc-1tbuii0-26"})(["display:flex;min-width:25px;width:25px;font-size:0.8em;"]),Y=a.default.span.withConfig({displayName:"UI__FeatureItemText",componentId:"sc-1tbuii0-27"})(["font-size:0.8em;color:white;"])},681:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return a}));var n=i(10),o=function(e){return Object(n.a)({url:"".concat("tours","/").concat(e,"/joinChat")})},a=function(e,t){return Object(n.a)({method:"POST",url:"".concat("tours","/").concat(e,"/requestShowing"),data:t})}},936:function(e,t,i){"use strict";i.r(t),i.d(t,"mapStateToProps",(function(){return lo})),i.d(t,"mapDispatchToProps",(function(){return po})),i.d(t,"LoadingSpinner",(function(){return yo}));var n=i(176),o=i.n(n),a=i(177),r=i.n(a),s=i(103),c=i.n(s),l=i(178),d=i.n(l),p=i(179),u=i.n(p),m=i(136),h=i.n(m),f=i(14),g=i.n(f),w=i(5),b=i.n(w),v=i(0),y=i.n(v),x=i(8),C=i.n(x),I=i(3),S=i.n(I),E=i(74),k=i(65),_=i(135),T=i(676),O=i.n(T),N=i(912),P=i(24),R=i.n(P),A=i(649),V=i.n(A),j=i(274),D=i(887),L=i(761),H=i(888),z=i.n(H),F=i(632),M=i.n(F),U=i(99),W=i.n(U),B=i(11),q=i(681),J="host",K="host_reset",G="host_request_changing",Y="scene",X="room_life_time_request",Z="infospot",$="You are now sharing your screen.",Q=" is now sharing their screen.",ee=" has joined the conversation.",te="You are following the host's screen.",ie="You stopped following the host's screen.",ne="Something went wrong.",oe="Something went wrong. Please make sure that the application has access to the camera.",ae=function(e){var t={type:J,data:{hostSid:e}};return JSON.stringify(t)},re=function(e){return V()(e)?null:"string"==typeof e?JSON.parse(e):e},se=function(e){return setTimeout((function(){e()}),18e5)},ce=function(e){return e.identity.split("::")[0]||e.identity},le=function(e){return R()(e,"localParticipant.sid",null)},de=function(e,t){return R()(e,"selectedImage.infospots",[]).filter((function(e){return e.id===t}))[0]||null},pe=i(614),ue=i(629),me=k.default.div.withConfig({displayName:"Lobby__CloudPanoText",componentId:"v0j3of-0"})(["font-family:'Pacifico',cursive;font-size:1rem;"]),he=Object(k.default)(pe.Horizontal).withConfig({displayName:"Lobby__LobbyHorizontal",componentId:"v0j3of-1"})(["width:80%;margin:auto;height:40px;display:flex;align-items:center;justify-content:space-between;&:not(:last-child){margin-bottom:10px;}"]),fe=Object(k.default)(pe.StyledInputBox).withConfig({displayName:"Lobby__LobbyInputBox",componentId:"v0j3of-2"})(["margin:unset;width:100%;"]),ge=Object(k.default)(pe.StyledButton).withConfig({displayName:"Lobby__LobbyButton",componentId:"v0j3of-3"})(["height:40px;",";"],(function(e){return e.disabledDueToMls&&"opacity:.8; &:hover{cursor:no-drop;} background:#00d9e1 !important;"})),we=function(e){var t=e.username,i=e.handleUsernameChange,n=e.handleRoomNameChange,o=e.handleSubmit,a=e.handleSchedule,r=e.tourId,s=e.sceneId,c=!r||!s;return S.a.createElement("form",{onSubmit:o},S.a.createElement("div",null,S.a.createElement("p",null,"Live video tours made possible by "),Object(B.isInDomain)()?S.a.createElement(me,null,"CloudPano"):S.a.createElement("p",null,window.location.origin.split("//")[1])),S.a.createElement("img",{width:"80%",src:"./assets/img/cloudpano-live-friendly-woman.jpg",alt:"Live chat on a 360 virtual tour"}),S.a.createElement("p",null,"Click Connect to join other participants."),S.a.createElement(he,null,S.a.createElement(fe,null,S.a.createElement(pe.StyledInput,{type:"text",id:"field",value:t,onChange:function(e){var t=e.target.value;i(t),n(r)},placeholder:"Enter Your Name",required:!0}))),S.a.createElement(he,null,S.a.createElement(ge,{type:"submit",disabled:c},"Connect"),e.viewerProps.tour.isScheduleEnabled&&S.a.createElement(I.Fragment,null,S.a.createElement("span",null,"OR"),S.a.createElement(ue.a,{title:"Scheduling disabled for MLS tours",position:"bottom",hide:!B.isMlsCompliant},S.a.createElement(ge,{type:"button",disabled:c,disabledDueToMls:B.isMlsCompliant,onClick:!B.isMlsCompliant&&a},"Book an Appointment")))))},be=i(682),ve=i.n(be),ye=i(98),xe=i(736),Ce=k.default.div.withConfig({displayName:"ConfirmContinueChating__Container",componentId:"njxn7i-0"})(["font-size:16px;"]),Ie=function(e){var t=e.viewerProps,i=e.confirm,n=e.cancel,o=Object(I.useState)(15),a=M()(o,2),r=a[0],s=a[1];Object(I.useEffect)((function(){var e=t.modal,i=null;return"confirm-continue-chating"===e&&(s(15),i=setInterval((function(){s((function(e){return e-1}))}),1e3)),function(){clearInterval(i)}}),[t.modal]),Object(I.useEffect)((function(){r||n()}),[r]);var c="Do you want to continue chatting? The window closes through ".concat(r," s.");return S.a.createElement(Ce,{className:"confirm-window-container"},S.a.createElement(xe.a,y()({},t,{unclosable:!0,modalName:"confirm-continue-chating",title:c,confirm:i,cancel:n,height:"auto"})))},Se=k.default.div.withConfig({displayName:"ConfirmHostChanging__Container",componentId:"t8cu5h-0"})(["font-size:16px;"]),Ee=function(e){var t=e.viewerProps,i=e.confirm,n=e.cancel;return S.a.createElement(Se,{className:"confirm-window-container"},S.a.createElement(xe.a,y()({},t,{unclosable:!0,modalName:"confirm-host-changing",title:"Another user requests to be a host. Allow host changing?",confirm:i,cancel:n,height:"auto"})))},ke=(i(869),i(870)),_e=i.n(ke),Te=i(871),Oe=i.n(Te),Ne=i(872),Pe=i.n(Ne),Re=i(873),Ae=i.n(Re),Ve=i(874),je=i.n(Ve),De=i(723),Le=i.n(De),He=i(875),ze=i.n(He),Fe=i(876),Me=i.n(Fe),Ue=i(30),We=i.n(Ue),Be={videoTracks:[],audioTracks:[],dataTracks:[],isVideoEnabled:!0,isAudioEnabled:!0,videoScalingFactor:1},qe=function(e,t){switch(t.type){case"ADD_VIDEO_TRACK":return function(e,t){return y()({},e,{videoTracks:[].concat(We()(e.videoTracks),[t.track])})}(e,t);case"REMOVE_VIDEO_TRACK":return function(e,t){var i=t.track,n=e.videoTracks.filter((function(e){return e.sid!==i.sid}));return y()({},e,{videoTracks:n})}(e,t);case"SET_VIDEO_TRACKS":return function(e,t){return y()({},e,{videoTracks:t.tracks})}(e,t);case"ADD_AUDIO_TRACK":return function(e,t){return y()({},e,{audioTracks:[].concat(We()(e.audioTracks),[t.track])})}(e,t);case"REMOVE_AUDIO_TRACK":return function(e,t){var i=t.track,n=e.audioTracks.filter((function(e){return e.sid!==i.sid}));return y()({},e,{audioTracks:n})}(e,t);case"SET_AUDIO_TRACKS":return function(e,t){return y()({},e,{audioTracks:t.tracks})}(e,t);case"ADD_DATA_TRACK":return function(e,t){return y()({},e,{dataTracks:[].concat(We()(e.dataTracks),[t.track])})}(e,t);case"REMOVE_DATA_TRACK":return function(e,t){var i=t.track,n=e.dataTracks.filter((function(e){return e.sid!==i.sid}));return y()({},e,{dataTracks:n})}(e,t);case"SET_DATA_TRACKS":return function(e,t){return y()({},e,{dataTracks:t.tracks})}(e,t);case"SET_VIDEO_STATUS":return function(e,t){return y()({},e,{isVideoEnabled:t.status})}(e,t);case"SET_AUDIO_STATUS":return function(e,t){return y()({},e,{isAudioEnabled:t.status})}(e,t);case"SET_VIDEO_SCALING_FACTOR":return function(e,t){return y()({},e,{videoScalingFactor:t.videoScalingFactor})}(e,t);default:return e}},Je=function(e){return{type:"SET_VIDEO_STATUS",status:e}},Ke=function(e){return{type:"SET_AUDIO_STATUS",status:e}},Ge=function(e){return{type:"SET_VIDEO_TRACKS",tracks:e}},Ye=function(e){return{type:"SET_AUDIO_TRACKS",tracks:e}},Xe=function(e){return{type:"SET_DATA_TRACKS",tracks:e}},Ze=k.default.div.withConfig({displayName:"Participant__Container",componentId:"sc-1wyu0wn-0"})(["display:flex;flex-direction:row;margin-top:20px;&:not(:last-child){margin-right:45px;","}"," &.over-limit{position:absolute;right:0;margin-right:0;.video,.video-placeholder,.participant-identity{visibility:hidden;pointer-events:none;}.video-container{background-color:transparent;}}@media screen and (","){&:not(:last-child){margin-right:35px;","}&.over-limit{margin-right:0;}}@media screen and (","){&:not(:last-child){margin-right:15px;","}&.over-limit{margin-right:0;}}"],(function(e){return e.isLocal&&Object(k.css)(["margin-right:0;"])}),(function(e){return e.isHide&&Object(k.css)(["display:none;"])}),B.media.down.lg,(function(e){return e.isLocal&&Object(k.css)(["margin-right:0;"])}),B.media.down.md,(function(e){return e.isLocal&&Object(k.css)(["margin-right:0;"])})),$e=k.default.div.withConfig({displayName:"Participant__ParticipantEntity",componentId:"sc-1wyu0wn-1"})(["width:140px;@media screen and (","){width:120px;}@media screen and (","){width:80px;","}"],B.media.down.lg,B.media.down.md,(function(e){return!e.isLocal&&Object(k.css)(["width:60px;"])})),Qe=k.default.div.withConfig({displayName:"Participant__VideoAndIndicators",componentId:"sc-1wyu0wn-2"})(["position:relative;"]),et=k.default.div.withConfig({displayName:"Participant__AudioIndicator",componentId:"sc-1wyu0wn-3"})(["position:absolute;top:110px;left:100px;width:25px;height:25px;pointer-events:none;@media screen and (","){top:100px;left:80px;width:20px;height:20px;}@media screen and (","){top:55px;left:60px;width:20px;height:20px;","}"],B.media.down.lg,B.media.down.md,(function(e){return!e.isLocal&&Object(k.css)(["top:40px;left:42px;"])})),tt=k.default.div.withConfig({displayName:"Participant__VideoContainer",componentId:"sc-1wyu0wn-4"})(["position:relative;height:140px;width:140px;border-radius:50%;top:0;right:0;overflow:hidden;background-color:rgba(0,0,0,0.6);-webkit-backface-visibility:hidden;-moz-backface-visibility:hidden;-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);"," @media screen and (","){height:120px;width:120px;}@media screen and (","){height:80px;width:80px;","}"],(function(e){return e.isHost&&Object(k.css)(["border:solid 1px rgba(0,128,0,0.5);box-shadow:0px 0px 5px 2px rgba(0,128,0,0.5);"])}),B.media.down.lg,B.media.down.md,(function(e){return!e.isLocal&&Object(k.css)(["height:60px;width:60px;"])})),it=k.default.div.withConfig({displayName:"Participant__VideoPlaceholder",componentId:"sc-1wyu0wn-5"})(["font-size:10px;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);@media screen and (","){font-size:8px;}"],B.media.down.md),nt=k.default.video.withConfig({displayName:"Participant__Video",componentId:"sc-1wyu0wn-6"})(["transform:translate(-50%,0) rotateY(180deg);margin-left:50%;height:100%;"," ",""],(function(e){var t=e.videoScalingFactor;return t&&Object(k.css)(["height:calc(100%*",");"],t)}),(function(e){return e.isHide&&Object(k.css)(["visibility:hidden;"])})),ot=k.default.p.withConfig({displayName:"Participant__ParticipantIdentity",componentId:"sc-1wyu0wn-7"})(["width:100%;z-index:100;text-shadow:black 1px 1px 8px;font-size:1rem;color:white;margin:16px 0 0;text-align:center;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;.emoji{margin-right:5px;margin-bottom:3px;}@media screen and (","){margin-top:10px;font-size:0.7rem;}"],B.media.down.md),at=k.default.audio.withConfig({displayName:"Participant__Audio",componentId:"sc-1wyu0wn-8"})([""]),rt=k.default.div.withConfig({displayName:"Participant__ButtonsContainer",componentId:"sc-1wyu0wn-9"})(["display:flex;flex-direction:column;align-items:flex-end;justify-content:space-between;max-height:140px;.stop-continue-tooltip{margin-right:12px;}@media screen and (","){max-height:120px;}@media screen and (","){max-height:80px;}"],B.media.down.lg,B.media.down.md),st=Object(k.default)(rt).withConfig({displayName:"Participant__LeftButtonsContainer",componentId:"sc-1wyu0wn-10"})(["flex-direction:column-reverse;"]),ct=k.default.button.withConfig({displayName:"Participant__ControlButton",componentId:"sc-1wyu0wn-11"})(["border:none;width:40px;height:40px;border-radius:50%;background:transparent;padding:0;margin:0;pointer-events:auto;@media screen and (","){width:35px;height:35px;}@media screen and (","){width:30px;height:30px;}"],B.media.down.lg,B.media.down.md),lt=Object(k.default)(ct).withConfig({displayName:"Participant__MainControlButton",componentId:"sc-1wyu0wn-12"})(["@media screen and (","){min-width:24px;min-height:24px;}"],B.media.down.md),dt=Object(k.default)(ct).withConfig({displayName:"Participant__SmallControlButton",componentId:"sc-1wyu0wn-13"})(["width:30px;height:30px;"]),pt=k.default.span.withConfig({displayName:"Participant__ButtonText",componentId:"sc-1wyu0wn-14"})(["display:inline-block;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;@media screen and (","){display:none;}"],B.media.up.md),ut=k.default.div.withConfig({displayName:"Participant__IconWrapper",componentId:"sc-1wyu0wn-15"})(["display:flex;justify-content:center;align-items:center;color:",";font-size:",";border-radius:50%;width:100%;height:100%;background-color:rgba(20,20,20,0.5);&:hover{background-color:rgba(0,0,0,0.6);}",""],(function(e){return e.iconColor||"white"}),(function(e){return e.fontSize||"1rem"}),(function(e){return e.isDisabled?Object(k.css)(["opacity:",";cursor:default;pointer-events:none;"],pe.disabledOpacity):Object(k.css)(["cursor:pointer;"])})),mt=Object(k.default)(ut).withConfig({displayName:"Participant__MainIconWrapper",componentId:"sc-1wyu0wn-16"})(["&.rotated-icon{transform:rotate(-90deg);}@media screen and (","){padding:2px 6px;font-size:13px;}"],B.media.down.md),ht=Object(k.default)(mt).withConfig({displayName:"Participant__IconWrapperGreen",componentId:"sc-1wyu0wn-17"})(["background-color:rgba(0,128,0,0.5);&:hover{background-color:rgba(0,100,0,0.6);}"]),ft=Object(k.default)(mt).withConfig({displayName:"Participant__IconWrapperOrange",componentId:"sc-1wyu0wn-18"})(["background-color:rgba(255,165,0,0.5);&:hover{background-color:rgba(255,140,0,0.6);}"]),gt=Object(k.default)(mt).withConfig({displayName:"Participant__IconWrapperRed",componentId:"sc-1wyu0wn-19"})(["background-color:rgba(218,80,71,0.5);&:hover{background-color:rgba(255,0,0,0.6);}"]),wt=Object(k.default)(ut).withConfig({displayName:"Participant__IconWrapperIndicator",componentId:"sc-1wyu0wn-20"})(["font-size:14px;@media screen and (","){font-size:12px;}@media screen and (","){font-size:10px;}"],B.media.down.lg,B.media.down.md),bt=k.default.img.withConfig({displayName:"Participant__ImageWrapper",componentId:"sc-1wyu0wn-21"})(["width:1.2em;height:.9em;"]),vt=k.default.div.withConfig({displayName:"Participant__ParticipantControls",componentId:"sc-1wyu0wn-22"})(["display:flex;flex-direction:row;align-items:flex-start;justify-content:space-between;"]),yt=function(e){var t=e.participant,i=e.isLocal,n=e.isStopTrack,o=e.isOverlimit,a=void 0!==o&&o,r=e.isHide,s=void 0!==r&&r,c=e.isRemoteParticipantsExist,l=e.host,d=e.toggleStopTrack,p=e.handleSendHostMsg,u=e.handleReceiveData,m=e.handleLogout,h=e.stopSharingScreen,f=e.sendHostRequestChangingMsg,g=e.sendSyncMessages,w=e.toggleHideRemoteParticipantas,b=void 0===w?function(){return null}:w,v=Object(I.useReducer)(qe,Be),y=M()(v,2),x=y[0],C=y[1],E=Object(I.useRef)(),k=Object(I.useRef)(),T=l&&t&&l.sid===t.sid,O=ce(t),N=function(e){var t=function(e){var t=R()(e,"dimensions.width",null),i=R()(e,"dimensions.height",null);return!t||!i||t>i?1:i/t}(e);C(function(e){return{type:"SET_VIDEO_SCALING_FACTOR",videoScalingFactor:e}}(t))},P=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};return Object(I.useEffect)((function(){return C(Ge(P(t.videoTracks))),C(Ye(P(t.audioTracks))),C(Xe(P(t.dataTracks))),t.on("trackSubscribed",(function(e){"data"===e.kind?(C(function(e){return{type:"ADD_DATA_TRACK",track:e}}(e)),e.on("message",(function(e){u(e)}))):"video"===e.kind?(C(function(e){return{type:"ADD_VIDEO_TRACK",track:e}}(e)),e.once("started",(function(e){N(e)}))):C(function(e){return{type:"ADD_AUDIO_TRACK",track:e}}(e))})),t.on("trackUnsubscribed",(function(e){"data"===e.kind&&i?C(function(e){return{type:"REMOVE_DATA_TRACK",track:e}}(e)):"video"===e.kind?C(function(e){return{type:"REMOVE_VIDEO_TRACK",track:e}}(e)):C(function(e){return{type:"REMOVE_AUDIO_TRACK",track:e}}(e))})),t.on("trackDisabled",(function(e){"video"===e.kind&&C(Je(!1)),"audio"===e.kind&&C(Ke(!1))})),t.on("trackEnabled",(function(e){"video"===e.kind&&C(Je(!0)),"audio"===e.kind&&C(Ke(!0))})),function(){C(Ge([])),C(Ye([])),C(Xe([])),t.removeAllListeners()}}),[]),Object(I.useEffect)((function(){var e=x.videoTracks[0];if(e)return e.attach(E.current),i&&N(e),function(){e.detach()}}),[x.videoTracks]),Object(I.useEffect)((function(){var e=x.audioTracks[0];if(e)return e.attach(E.current),function(){e.detach()}}),[x.audioTracks]),Object(I.useEffect)((function(){g()}),[x.dataTracks]),S.a.createElement(Ze,{isOverlimit:a,className:a?"over-limit":null,isHide:s,isLocal:i},i&&S.a.createElement(rt,null,S.a.createElement(ue.a,{title:T?"Stop Sharing my Screen":"Share my Screen",position:"left",hideOnMobileDevices:!0},S.a.createElement(lt,{isHost:T,onClick:function(){T?h(t.sid):l?f(t.sid):p(t.sid)}},T?S.a.createElement(ft,{isDisabled:!1},S.a.createElement(_.a,{icon:Oe.a})):S.a.createElement(ht,{className:"rotated-icon",isDisabled:!1},S.a.createElement(_.a,{icon:_e.a})))),!T&&l&&S.a.createElement(ue.a,{className:"stop-continue-tooltip",title:n?"Click to follow host's camera":"Click to stop following host",position:"left",hideOnMobileDevices:!0},S.a.createElement(lt,{onClick:d},S.a.createElement(ft,{isDisabled:!1},n?S.a.createElement(S.a.Fragment,null,S.a.createElement(_.a,{icon:Oe.a}),S.a.createElement(pt,null,"Listening")):S.a.createElement(S.a.Fragment,null,S.a.createElement(bt,{src:"./assets/img/video-chat-stop-tracking.gif"}),S.a.createElement(pt,null,"Stop Listening"))))),S.a.createElement(ue.a,{title:"Log out",position:"left",hideOnMobileDevices:!0},S.a.createElement(lt,{onClick:function(){return m()}},S.a.createElement(gt,{isDisabled:!1},S.a.createElement(_.a,{icon:_e.a}))))),S.a.createElement($e,{isLocal:i},S.a.createElement(Qe,null,S.a.createElement(tt,{className:"video-container",isHost:T,isLocal:i},S.a.createElement(it,{className:"video-placeholder"},S.a.createElement(_.a,{icon:Pe.a,size:"5x"})),S.a.createElement(nt,{className:"video",ref:E,autoPlay:!0,isHide:!x.isVideoEnabled,videoScalingFactor:x.videoScalingFactor})),!i&&!x.isAudioEnabled&&S.a.createElement(et,{isLocal:i},S.a.createElement(wt,{isDisabled:!1},S.a.createElement(_.a,{icon:je.a})))),i&&S.a.createElement(vt,null,S.a.createElement(ct,{onClick:function(e){e.stopPropagation(),t.audioTracks.forEach((function(e){e.track.isEnabled?e.track.disable():e.track.enable(),C(Ke(e.track.isEnabled))}))}},S.a.createElement(ut,{isDisabled:!1},x.isAudioEnabled?S.a.createElement(_.a,{icon:Ae.a}):S.a.createElement(_.a,{icon:je.a}))),S.a.createElement(ct,{onClick:function(e){e.stopPropagation(),t.videoTracks.forEach((function(e){e.track.isEnabled?e.track.disable():e.track.enable(),C(Je(e.track.isEnabled))}))}},S.a.createElement(ut,{isDisabled:!1},x.isVideoEnabled?S.a.createElement(_.a,{icon:Le.a}):S.a.createElement(_.a,{icon:ze.a})))),S.a.createElement(ot,{className:"participant-identity"},T&&S.a.createElement("span",{className:"emoji",role:"img","aria-label":"Crown"},"👑"),O),S.a.createElement(at,{ref:k,autoPlay:!0})),i&&c&&S.a.createElement(st,null,S.a.createElement(dt,{onClick:b},S.a.createElement(ut,{isDisabled:!1},S.a.createElement(_.a,{icon:Me.a})))))},xt=i(51),Ct=i.n(xt),It=i(877),St=i.n(It);function Et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h()(e);if(t){var o=h()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return u()(this,i)}}var kt=function(e){d()(i,e);var t=Et(i);function i(e){var n;return o()(this,i),n=t.call(this,e),g()(c()(n),"changeLimit",(function(){var e=n.state.limit;window.innerWidth<B.SBP.xs&&1!==e?n.setState({limit:1}):window.innerWidth>=B.SBP.xs&&3!==e&&n.setState({limit:3})})),g()(c()(n),"throttledChangeLimit",St()(n.changeLimit,200)),n.state={limit:3},n}return r()(i,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.throttledChangeLimit),this.changeLimit()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.throttledChangeLimit)}},{key:"render",value:function(){var e=this.props,t=e.participants,i=e.isHide,n=Ct()(e,["participants","isHide"]),o=this.state.limit,a=t.map((function(e,t){var a=!(o>t);return S.a.createElement(yt,y()({key:e.sid,participant:e,isOverlimit:a,isHide:i},n))})),r=t.length-o,s=r>0,c=s?"+".concat(r):"...";return S.a.createElement(_t,{className:"remote-participants"},a,s&&!i&&S.a.createElement(Tt,null,S.a.createElement(Ot,null,c)))}}]),i}(S.a.PureComponent),_t=k.default.div.withConfig({displayName:"RemoteParticipants__Container",componentId:"sc-1lqn5wv-0"})(["display:flex;flex-direction:row;"]),Tt=k.default.div.withConfig({displayName:"RemoteParticipants__OtherParticipants",componentId:"sc-1lqn5wv-1"})(["position:relative;height:140px;width:140px;border-radius:50%;top:0;right:0;overflow:hidden;background-color:rgba(0,0,0,0.5);margin-top:20px;@media screen and (","){height:120px;width:120px;}@media screen and (","){height:60px;width:60px;}"],B.media.down.lg,B.media.down.md),Ot=k.default.div.withConfig({displayName:"RemoteParticipants__Count",componentId:"sc-1lqn5wv-2"})(["display:block;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:18px;pointer-events:none;"]),Nt=kt,Pt={room:null,participants:[],host:null,isHost:!1,isStopTrack:!1,continueStatus:0,isHideRemoteParticipantas:!1,lastSelectedInfospotId:null},Rt=function(e,t){switch(t.type){case"ADD_PARTICIPANT":return function(e,t){var i=t.participant,n=e.participants,o=[].concat(We()(n),[i]);return y()({},e,{participants:o})}(e,t);case"REMOVE_PARTICIPANT":return function(e,t){var i=t.participant,n=e.participants.filter((function(e){return e.sid!==i.sid}));return y()({},e,{participants:n})}(e,t);case"SET_HOST":return function(e,t){var i=t.host;return y()({},e,{host:i})}(e,t);case"SET_HOST_STATUS":return function(e,t){var i=t.isHost;return y()({},e,{isHost:i})}(e,t);case"SET_STOP_TRACK":return function(e,t){var i=t.isStopTrack;return y()({},e,{isStopTrack:i})}(e,t);case"TOGGLE_STOP_TRACK":return function(e){var t=e.isStopTrack;return y()({},e,{isStopTrack:!t})}(e);case"SET_CONTINUE_STATUS":return function(e,t){var i=t.continueStatus;return y()({},e,{continueStatus:i})}(e,t);case"NEXT_CONTINUE_STATUS":return function(e){var t=e.continueStatus+1;return y()({},e,{continueStatus:t})}(e);case"SET_HIDE_REMOTE_PARTICIPANTS":return function(e,t){var i=t.isHideRemoteParticipantas;return y()({},e,{isHideRemoteParticipantas:i})}(e,t);case"TOGGLE_HIDE_REMOTE_PARTICIPANTS":return function(e){var t=e.isHideRemoteParticipantas;return y()({},e,{isHideRemoteParticipantas:!t})}(e);case"SET_ROOM":return function(e,t){var i=t.room;return y()({},e,{room:i})}(e,t);case"SET_LAST_SELECTED_INFOSPOT_ID":return function(e,t){var i=t.lastSelectedInfospotId;return y()({},e,{lastSelectedInfospotId:i})}(e,t);default:return e}},At=function(e){return{type:"SET_HOST",host:e}},Vt=function(e){return{type:"SET_HOST_STATUS",isHost:e}},jt=function(e){return{type:"SET_STOP_TRACK",isStopTrack:e}},Dt=new(0,i(682).LocalDataTrack),Lt=k.default.div.withConfig({displayName:"Room__ParticipantsContainer",componentId:"sc-8nsts2-0"})(["display:flex;flex-direction:row;"]),Ht=function(e){var t=e.roomName,i=e.token,n=e.handleLogout,o=e.setCameraForStreaming,a=e.setEnableControls,r=e.setDisableControls,s=e.sceneId,c=e.viewer,l=e.viewerProps,d=e.selectedInfospotId,p=e.setSelectedHtmlInfospot,u=Object(I.useReducer)(Rt,Pt),m=M()(u,2),h=m[0],f=m[1],g=Object(I.useRef)(h.room),w=Object(I.useRef)(h.host),v=Object(I.useRef)(h.isStopTrack),x=Object(I.useRef)(null),E=Object(I.useRef)(null),k=Object(I.useRef)(!0),_=Object(I.useMemo)((function(){return h.participants.length>0}),[h.participants]),T=Object(I.useCallback)((function(){f({type:"TOGGLE_STOP_TRACK"});var e=de(l,h.lastSelectedInfospotId);p(e)}),[h.lastSelectedInfospotId]),O=Object(I.useCallback)((function(){return f({type:"TOGGLE_HIDE_REMOTE_PARTICIPANTS"})}),[]),N=function(e){var t=ce(e),i="".concat(t," ").concat(Q);Object(ye.b)(i)},P=function(){var e=function(e){var t={type:X,data:{senderSid:e}};return JSON.stringify(t)}(g.current.localParticipant.sid);Dt.send(e)},R=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=l.openModal;e&&P(),t("confirm-continue-chating")},A=function(e,t){var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{isReturnObj:!1},i=e.senderSid,n=e.sceneId,o=e.coords,a=e.fov,r=t.isReturnObj,s={type:Y,data:{senderSid:i,sceneId:n,coords:y()({},o),fov:a}};return r?s:JSON.stringify(s)}({senderSid:h.room.localParticipant.sid,sceneId:s,coords:e,fov:t});Dt.send(i)},V=function(e,t){var i=function(e,t){var i={type:Z,data:{senderSid:e,infospotId:t}};return JSON.stringify(i)}(e,t);Dt.send(i)},j=Object(I.useCallback)((function(e){var t=ae(e);Dt.send(t);var i=h.room.localParticipant.sid===e?h.room.localParticipant:h.room.participants.get(e);i&&(f(At(i)),h.room.localParticipant.sid===e?(f(Vt(!0)),a(),Object(ye.b)($)):(f(Vt(!1)),r(),N(i)))}),[h.host,h.room,h.participants]),D=Object(I.useCallback)((function(e){var t,i=(t={type:G,data:{senderSid:e}},JSON.stringify(t));Dt.send(i)}),[]),L=function(){f(At(null)),f(Vt(!1)),v.current?f(jt(!1)):a()},H=function(e){var t,i=(t={type:K,data:{senderSid:e}},JSON.stringify(t));Dt.send(i),L()},z=Object(I.useCallback)((function(e){var t=re(e);if(t)if(re(t).type!==J)if(function(e){return re(e).type===K}(t))L();else if(function(e){return re(e).type===Z}(t))!function(e){var t=e.data.infospotId,i=de(l,t);f({type:"SET_LAST_SELECTED_INFOSPOT_ID",lastSelectedInfospotId:t}),v.current||p(i)}(t);else if(function(e){return re(e).type===G}(t))!function(e){var t=l.openModal;E.current=e,w.current&&w.current.sid===g.current.localParticipant.sid&&t("confirm-host-changing")}(t);else{if(function(e){return re(e).type===X}(t))return clearTimeout(x.current),void R(!1);var i=t.data,n=i.senderSid,s=i.sceneId,c=i.coords,d=i.fov;n===h.room.localParticipant.sid||v.current||o(c,s,d)}else!function(e,t){var i=e.data.hostSid,n=t.localParticipant.sid===i?t.localParticipant:t.participants.get(i);if(n){var o=null===w.current;f(At(n)),n.identity===t.localParticipant.identity?(f(Vt(!0)),a(),Object(ye.b)($)):(f(Vt(!1)),h.isStopTrack||r(),f(jt(!1)),o&&N(n))}}(t,h.room)}),[h.host,h.room,h.participants]),F=function(){if(w.current&&w.current.sid===g.current.localParticipant.sid){var e=ae(w.current.sid);Dt.send(e),function(e,t,i){if(e&&t){var n=le(h.room);V(n,i)}}(h.room,h.isHost,d)}};return Object(I.useEffect)((function(){g.current=h.room}),[h.room]),Object(I.useEffect)((function(){w.current=h.host}),[h.host]),Object(I.useEffect)((function(){var e=null;return h.continueStatus&&(e=se(R)),function(){clearTimeout(e)}}),[h.continueStatus]),Object(I.useEffect)((function(){var e=function(e){f(function(e){return{type:"ADD_PARTICIPANT",participant:e}}(e)),function(e){var t=ce(e),i="".concat(t," ").concat(ee);Object(ye.b)(i)}(e)},o=function(e){w.current&&w.current.sid===e.sid&&(a(),f(At(null)),f(Vt(!1))),f(function(e){return{type:"REMOVE_PARTICIPANT",participant:e}}(e))};return function(){var a=C()(b.a.mark((function a(){var r,s;return b.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,ve.a.createLocalTracks({audio:!0,video:{name:"camera",width:{min:640,ideal:1280},height:{min:360,ideal:720}}});case 3:return r=a.sent,a.next=6,ve.a.connect(i,{name:t,tracks:r,preferredVideoCodecs:["VP8"]});case 6:s=a.sent,f({type:"SET_ROOM",room:s}),s.on("participantConnected",e),s.on("participantDisconnected",o),s.participants.forEach(e),s.localParticipant.publishTrack(Dt,{name:"dataTrack"}),x.current=se(R),a.next=20;break;case 15:a.prev=15,a.t0=a.catch(0),console.log(a.t0),a.t0.message&&a.t0.name&&"TwilioError"===a.t0.name?Object(ye.a)(ne+a.t0.message):Object(ye.a)(oe),n();case 20:case"end":return a.stop()}}),a,null,[[0,15]])})));return function(){return a.apply(this,arguments)}}()(),function(){var e=g.current;e&&"connected"===e.localParticipant.state&&(e.localParticipant.tracks.forEach((function(t){"data"!==t.track.kind&&t.track.stop(),e.localParticipant.unpublishTrack(t.track,!0)})),e&&"connected"===e.state&&e.disconnect()),a()}}),[t,i]),Object(I.useEffect)((function(){if(c&&c.OrbitControls&&h.isHost){var e=function(e){A(e.target.object.position,e.target.object.fov)};return c.OrbitControls.addEventListener("change",e),function(){c.OrbitControls.removeEventListener("change",e)}}}),[c,h.isHost,s]),Object(I.useEffect)((function(){v.current=h.isStopTrack,k.current?k.current=!1:h.isStopTrack&&w.current?(a(),Object(ye.b)(ie)):!h.isStopTrack&&w.current?(r(),Object(ye.b)(te)):a()}),[h.isStopTrack]),Object(I.useEffect)((function(){if(h.room&&h.isHost){var e=le(h.room);V(e,d)}}),[d,h.room,h.isHost]),S.a.createElement(S.a.Fragment,null,S.a.createElement(Lt,null,h.room?S.a.createElement(yt,{isLocal:!0,key:h.room.localParticipant.sid,participant:h.room.localParticipant,host:h.host,toggleStopTrack:T,handleReceiveData:z,handleSendHostMsg:j,handleLogout:n,stopSharingScreen:H,sendHostRequestChangingMsg:D,sendSyncMessages:F,isStopTrack:h.isStopTrack,toggleHideRemoteParticipantas:O,isRemoteParticipantsExist:_}):"",S.a.createElement(Nt,{participants:h.participants,host:h.host,toggleStopTrack:T,handleReceiveData:z,handleSendHostMsg:j,handleLogout:n,stopSharingScreen:H,sendHostRequestChangingMsg:D,sendSyncMessages:F,isStopTrack:h.isStopTrack,isHide:h.isHideRemoteParticipantas,isRemoteParticipantsExist:_})),S.a.createElement(Ie,{viewerProps:l,confirm:function(){(0,l.closeModal)(),f({type:"NEXT_CONTINUE_STATUS"})},cancel:function(){(0,l.closeModal)(),n()}}),S.a.createElement(Ee,{viewerProps:l,confirm:function(){var e=l.closeModal,t=E.current.data.senderSid;j(t),e()},cancel:function(){(0,l.closeModal)()}}))},zt=k.default.div.withConfig({displayName:"VideoChat__Wrapper",componentId:"t4hqc4-0"})(["position:absolute;right:1.5em;top:0;z-index:1000;color:white;font-family:'Lato',sans-serif;font-size:10px;pointer-events:none;"," .confirm-window-container{pointer-events:auto;}"],(function(e){return e.isInfoSpotModalOpen&&Object(k.css)(["& > *:not(.confirm-window-container){opacity:0.3;}"])})),Ft=k.default.div.withConfig({displayName:"VideoChat__LobbyWrapper",componentId:"t4hqc4-1"})(["position:absolute;width:300px;right:1.5em;top:0;margin-left:-100px;z-index:1000;color:white;font-family:'Lato',sans-serif;font-size:10px;text-align:center;border-radius:0 0 0.5em 0.5em;display:unset;box-shadow:7px 6px 20px 0px black;background-color:gray;transition-property:all;transition-duration:.5s;transition-timing-function:cubic-bezier(0,1,0.5,1);right:6.5em;@media screen and (","){width:calc(100% - 7em);}"],B.media.down.xsm),Mt=function(e){var t=e.tourId,i=e.sceneId,n=e.setCameraForStreaming,o=e.setEnableControls,a=e.setDisableControls,r=e.setVideoChatStatus,s=e.viewer,c=e.viewerProps,l=e.user,d=e.selectedInfospotId,p=e.setSelectedHtmlInfospot,u=Object(I.useState)(""),m=M()(u,2),h=m[0],f=m[1],g=Object(I.useState)(null),w=M()(g,2),v=w[0],x=w[1],E=Object(I.useState)(null),k=M()(E,2),_=k[0],T=k[1],O=Object(I.useRef)(W.a.generate()),N=function(){var e=C()(b.a.mark((function e(){var i,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(h||l.name,"::").concat(O.current),r(!0),e.prev=2,e.next=5,fetch("/api/twilio/video-token",{method:"POST",body:JSON.stringify({identity:i,room:v||t}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()}));case 5:n=e.sent,T(n.token),!c.tour.isNotifyEnabled||"guest"!==l.type&&l.id===c.tour.userId||Object(q.a)(c.tour.shortId),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),T(null),r(!1);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),P=Object(I.useMemo)((function(){return function(e){return!!R()(e,"modal",null)}(c)}),[c.modal]);Object(I.useEffect)((function(){"guest"===l.type||l.id!==c.tour.userId?"guest"!==l.type&&(f(l.name),x(t)):N()}),[l.type]);var A=Object(I.useCallback)((function(e){f(e)}),[]),V=Object(I.useCallback)((function(e){x(e)}),[]),j=Object(I.useCallback)((function(e){e.preventDefault(),N()}),[h,v]),D=Object(I.useCallback)((function(){p(null),T(null),r(!1)}),[]);return _?S.a.createElement(zt,{isInfoSpotModalOpen:P},S.a.createElement(Ht,{viewerProps:c,setCameraForStreaming:n,roomName:v,sceneId:i,token:_,handleLogout:D,viewer:s,setEnableControls:o,setDisableControls:a,selectedInfospotId:d,setSelectedHtmlInfospot:p})):"guest"===l.type||l.id!==c.tour.userId?S.a.createElement(Ft,null,S.a.createElement(we,y()({username:h,roomName:v,tourId:t,sceneId:i,handleUsernameChange:A,handleRoomNameChange:V,handleSubmit:j,handleSchedule:function(){c.updateScheduleForm(y()({},c.scheduleShowingForm,{name:h})),c.openModal("request-showing-tour")}},e))):null},Ut=i(27),Wt=i(725),Bt=i.n(Wt),qt=i(913),Jt=i(23),Kt=function(e){return{type:Jt.o,tour:e}},Gt=function(e){return{type:Jt.g,modal:e}},Yt=function(){return{type:Jt.b}},Xt=i(72),Zt=i(658),$t=i.n(Zt),Qt=i(659),ei=i.n(Qt),ti=i(640),ii=i.n(ti),ni=i(641),oi=i.n(ni),ai=k.default.div.withConfig({displayName:"UI__LogoDescriptionContainer",componentId:"sc-1clwifi-0"})(["position:absolute;",";z-index:1;"],(function(e){return e.isCascade?Object(k.css)(["right:4em;top:2em;"]):Object(k.css)(["left:15px;top:15px;"])})),ri=k.default.img.withConfig({displayName:"UI__Logo",componentId:"sc-1clwifi-1"})(["max-width:10em;max-height:8em;@media screen and (max-width:60em){max-width:4em;max-height:3em;}"]),si=(k.default.div.withConfig({displayName:"UI__BrandingIcon",componentId:"sc-1clwifi-2"})(["background:url('/public/logo.png') no-repeat center;margin-top:1em;background-color:rgba(88,88,90,0.7);background-size:1.5em;padding:1.25em;border-radius:0.4em;cursor:pointer;&:hover{background:url('/public/logo-i.png') no-repeat center;background-color:rgba(88,88,90,0.7);background-size:2em;}"]),k.default.div.withConfig({displayName:"UI__Description",componentId:"sc-1clwifi-3"})(["color:white;text-shadow:1px 1px 2px #333;"])),ci=k.default.div.withConfig({displayName:"UI__NameProperty",componentId:"sc-1clwifi-4"})(["font-size:18px;margin:5px 0px;"]),li=k.default.div.withConfig({displayName:"UI__SecondaryProperty",componentId:"sc-1clwifi-5"})(["font-size:13px;margin:5px 0px;cursor:pointer;width:fit-content;"]),di=k.default.div.withConfig({displayName:"UI__Reel",componentId:"sc-1clwifi-6"})(["z-index:1;width:100%;position:absolute;bottom:0em;left:0em;",";display:flex;font-weight:100;"],(function(e){return e.visible?"background-color: rgba(88, 88, 90, 0.7);":"background-color: rgba(0, 0, 0, 0);"})),pi=function(e){return S.a.createElement(fi,{reelvisible:e.reelvisible?1:0,onClick:e.onClick,icon:e.reelvisible?ei.a:$t.a})},ui=Object(k.default)(_.a).withConfig({displayName:"UI__ImageCycleIcon",componentId:"sc-1clwifi-7"})(["position:absolute;z-index:3;width:2em;text-shadow:1px 1px 2px #333;color:white;font-size:2em;bottom:",";",";",";@media screen and (max-height:40em){margin-bottom:0.6em;}"],(function(e){return e.reelvisible?"5em":0}),(function(e){return e.left?"left: 2em;":"right: 2em;"}),(function(e){return e.disabled?Object(k.css)(["cursor:default;opacity:",";"],pe.disabledOpacity):Object(k.css)(["cursor:pointer;"])})),mi=function(e){return S.a.createElement(ui,{reelvisible:e.reelvisible,onClick:e.disabled?function(){return null}:e.onClick,icon:oi.a,right:"true",disabled:e.disabled})},hi=function(e){return S.a.createElement(ui,{reelvisible:e.reelvisible,onClick:e.disabled?function(){return null}:e.onClick,icon:ii.a,left:"true"})},fi=Object(k.default)(_.a).withConfig({displayName:"UI__Icon",componentId:"sc-1clwifi-8"})(["position:absolute;top:-1em;z-index:3;width:2em;text-shadow:1px 1px 2px #333;color:white;font-size:2em;margin-left:50%;cursor:pointer;",";"],(function(e){return e.reelvisible?"\n  ":"\n  position: absolute;\n  bottom: 0;\n  margin-bottom: -0.6em;\n  "})),gi=k.default.div.withConfig({displayName:"UI__TitleContainer",componentId:"sc-1clwifi-9"})(["width:10em;text-align:center;color:white;margin-bottom:0.6em;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;"]),wi=k.default.div.withConfig({displayName:"UI__ImgContainer",componentId:"sc-1clwifi-10"})(["display:flex;flex-direction:column;align-items:center;padding:0.2em;height:100%;margin-top:0.2em;",""],(function(e){return e.isDisabled?Object(k.css)(["opacity:",";pointer-events:none;"],pe.disabledOpacity):null})),bi=k.default.img.withConfig({displayName:"UI__Image",componentId:"sc-1clwifi-11"})(["height:100%;width:10em;min-width:10em;transition:all 0.3s;object-fit:cover;cursor:pointer;position:absolute;top:0;left:0;&:hover{transform:scale(1.1);transition:all 0.3s;}",""],(function(e){return e.disabled?Object(k.css)(["cursor:not-allowed;pointer-events:none;"]):null})),vi=k.default.div.withConfig({displayName:"UI__Previews",componentId:"sc-1clwifi-12"})(["height:10em;display:flex;overflow-x:scroll;overflow-y:hidden;z-index:1;transition:all 0.3s;",";@media screen and (max-height:40em){",";height:8em;}::-webkit-scrollbar-thumb{box-shadow:inset 0 0 16px white;-webkit-box-shadow:inset 0 0 16px white;background-color:rgba(42,48,56,0.7);}"],(function(e){return e.visible?"margin-bottom: 0;":"margin-bottom: -10em; display:none;"}),(function(e){return e.visible?"margin-bottom: 0;":"margin-bottom: -6.8em; padding-top: 3.2em;"})),yi=k.default.div.withConfig({displayName:"UI__PreviewImage",componentId:"sc-1clwifi-13"})(["position:relative;",";overflow:hidden;height:80%;width:10em;min-width:10em;&:hover{border:0.2em solid #20b2aa;}"],(function(e){return e.active?"border: 0.2em solid #008B8B":"border: 0.2em solid white"})),xi=k.default.div.withConfig({displayName:"UI__EmptyImagePlaceholder",componentId:"sc-1clwifi-14"})(["position:absolute;left:0;top:0;display:flex;align-items:center;justify-content:center;background-color:white;width:100%;height:100%;"]),Ci=Object(k.default)(_.a).withConfig({displayName:"UI__ImageIcon",componentId:"sc-1clwifi-15"})(["color:grey;font-size:35px;"]),Ii=(k.default.button.withConfig({displayName:"UI__InfoButton",componentId:"sc-1clwifi-16"})(["background-color:rgba(88,88,90,0.7);"]),k.default.div.withConfig({displayName:"UI__IconWrapper",componentId:"sc-1clwifi-17"})(["margin-top:1em;background-color:rgba(88,88,90,0.7);font-size:1em;text-align:center;padding:0.6em;padding-right:0.8em;padding-left:0.8em;border-radius:0.4em;cursor:pointer;color:white;&:hover{color:#008b8b;}"]),i(893)),Si=i.n(Ii),Ei=i(900),ki=i.n(Ei),_i=(i(881),i(882)),Ti=i.n(_i),Oi=i(679),Ni=i.n(Oi),Pi=i(883),Ri=i.n(Pi),Ai=i(884),Vi=i.n(Ai),ji=i(885),Di=i.n(ji),Li=i(886),Hi=i.n(Li),zi=k.default.div.withConfig({displayName:"ViewerAmbienceControl__Wrapper",componentId:"sc-1jdsu0j-0"})(["z-index:1;position:relative;display:flex;flex-direction:column;"]),Fi=k.default.div.withConfig({displayName:"ViewerAmbienceControl__IconWrapper",componentId:"sc-1jdsu0j-1"})(["display:flex;justify-content:center;align-items:center;color:white;width:40px !important;height:40px;font-size:1rem;margin-bottom:.3em;background:rgba(20,20,20,0.5);border-radius:.5em;"," "," &:hover{background:rgba(0,0,0,0.6);}"],(function(e){return e.title===e.commonStr.editTour&&"padding-left: .25em;"}),(function(e){return e.isDisabled?Object(k.css)(["opacity:",";cursor:default;pointer-events:none;"],pe.disabledOpacity):Object(k.css)(["cursor:pointer;"])})),Mi=Object(E.connect)((function(e){return{viewerStr:e.app.localization.viewerStr,commonStr:e.app.localization.commonStr}}),null)((function(e){var t=e.ambience,i=e.setAmbiencePlaying,n=e.isDisabled,o=void 0!==n&&n,a=e.viewerStr,r=e.commonStr,s=t.playing?Hi.a:Di.a;return S.a.createElement(zi,null,S.a.createElement(ue.a,{title:a.toggleAmbientSound,position:"left",isDisabled:o},S.a.createElement(Fi,{onClick:i,title:a.toggleAmbientSound,isDisabled:o,commonStr:r},S.a.createElement(_.a,{icon:s}))))})),Ui=function(e){var t=e.items,i=e.isDisabled,n=e.isHideTourViewerControls,o=e.commonStr,a=t.map((function(e){return!e.hide&&S.a.createElement(Gi,{key:e.title,href:i?"#":e.link},S.a.createElement(ue.a,{title:e.title,position:"left",isDisabled:i},S.a.createElement(qi,{onClick:e.onClick,title:e.title,iconColor:e.iconColor,isDisabled:i,commonStr:o},e.image||S.a.createElement(_.a,{icon:e.icon}))))}));return!n&&a},Wi=function(e){var t=e.isHideTourViewerControls,i=e.toggleHideTourViewerControls,n=e.commonStr,o=t?"Show controls":"Hide controls";return S.a.createElement(ue.a,{title:o,position:"left"},S.a.createElement(qi,{onClick:i,title:o,commonStr:n},t?S.a.createElement(_.a,{icon:Ri.a}):S.a.createElement(_.a,{icon:Vi.a})))},Bi=k.default.div.withConfig({displayName:"Sidebar__Wrapper",componentId:"sc-1qyuuh2-0"})(["position:absolute;z-index:3;right:1em;display:flex;top:50%;flex-direction:column;align-items:flex-end;transform:translateY(-50%);",""],(function(e){return e.isVideoChatStarted?Object(k.css)(["top:47%;@media screen and (max-height:768px){flex-direction:row;top:unset;bottom:25%;}@media screen and (max-height:640px){bottom:110px;}"]):Object(k.css)(["@media screen and (max-height:640px){top:2em;transform:unset;}"])})),qi=k.default.div.withConfig({displayName:"Sidebar__IconWrapper",componentId:"sc-1qyuuh2-1"})(["display:flex;justify-content:center;align-items:center;color:",";width:40px !important;height:40px;font-size:1rem;margin-bottom:.3em;background:rgba(20,20,20,0.5);border-radius:.5em;"," "," &:hover{background:rgba(0,0,0,0.6);}"],(function(e){return e.iconColor||"white"}),(function(e){return e.title===e.commonStr.editTour&&"padding-left: .25em;"}),(function(e){return e.isDisabled?Object(k.css)(["opacity:",";cursor:default;pointer-events:none;"],pe.disabledOpacity):Object(k.css)(["cursor:pointer;"])})),Ji=(k.default.img.withConfig({displayName:"Sidebar__DashboardIcon",componentId:"sc-1qyuuh2-2"})(["width:1.2em;height:.9em;"]),k.default.img.withConfig({displayName:"Sidebar__CardboardIcon",componentId:"sc-1qyuuh2-3"})(["width:1.4em;"])),Ki=k.default.img.withConfig({displayName:"Sidebar__TooogleMotionIcon",componentId:"sc-1qyuuh2-4"})(["width:1.4em;width:20px;height:20px;animation-name:nudge;animation-duration:.4s;animation-timing-function:linear;animation-delay:2s;animation-iteration-count:1;@keyframes nudge{0%{transform:rotate(-7deg);}33%{transform:rotate(7deg);}66%{transform:rotate(-7deg);}}"]),Gi=(k.default.img.withConfig({displayName:"Sidebar__LogoIcon",componentId:"sc-1qyuuh2-5"})(["width:1.5ßem;height:1.5em;"]),k.default.a.withConfig({displayName:"Sidebar__CustomLink",componentId:"sc-1qyuuh2-6"})([""])),Yi=(Object(k.default)(_.a).withConfig({displayName:"Sidebar__LoadingSpinner",componentId:"sc-1qyuuh2-7"})(["position:absolute;left:50%;top:40%;font-size:4em;color:",";"],pe.actionColor),Object(E.connect)((function(e){return{commonStr:e.app.localization.commonStr,viewerStr:e.app.localization.viewerStr}}),null)((function(e){var t=e.vr,i=e.tour,n=e.openModal,o=e.setFullscreen,a=e.toggleMotionConrol,r=e.toggleVR,s=e.toggleVideoChatView,c=e.toggleHideTourViewerControls,l=e.mlsCompliant,d=e.isVideoChatStarted,p=e.isDisabled,u=void 0!==p&&p,m=e.isHideTourViewerControls,h=e.sound,f=e.setAmbiencePlaying,g=e.commonStr,w=e.viewerStr,b=h&&h.ambience&&h.ambience.audio,v=R()(i,"config.isHideShareButton",!1),y=[{title:g.share,icon:Ti.a,onClick:function(){return n("share")},hide:v||t||l},{title:w.fullscreen,icon:Ni.a,onClick:function(){return o()},hide:t||B.mobileNavigator},{title:g.toggleMotionControl,image:S.a.createElement(Ki,{src:"./assets/img/refresh_5.svg"}),onClick:function(){return a()},hide:t||!B.mobileNavigator},{title:w.virtualReality,image:S.a.createElement(Ji,{src:"./assets/img/cardboard.png"}),onClick:function(){return r()},vrActive:t},{title:w.videoChat,icon:Le.a,onClick:function(){return s()},hide:t||d||!i||!i.isVideoChatEnabled}];return Object(I.useEffect)((function(){b&&d&&f(!1,h.ambience.audio)}),[d,b]),S.a.createElement(Bi,{isVideoChatStarted:d},S.a.createElement(Wi,{isHideTourViewerControls:m,toggleHideTourViewerControls:c,commonStr:g}),h.ambience.audio&&!m?S.a.createElement("div",null,S.a.createElement(Mi,{ambience:h.ambience,isDisabled:u,setAmbiencePlaying:function(){u||f(!h.ambience.playing,h.ambience.audio)}})):null,S.a.createElement(Ui,{items:y,isDisabled:u,isHideTourViewerControls:m,commonStr:g}))}))),Xi=i(724),Zi=Object(k.default)(Xi.a).withConfig({displayName:"Room__Wrapper",componentId:"pxxumo-0"})(["color:white;width:","px;overflow:hidden;position:relative;background:",";cursor:pointer;margin:12px ","px;border-radius:8px;flex-shrink:0;&:first-child{margin-left:30px;}@media screen and (max-width:","){width:160px;}@media screen and (max-width:","){width:140px;}"],200,pe.borderColor,5,B.mobileWidth,B.xsMobileWidth),$i=Object(k.default)(Zi).withConfig({displayName:"Room__ActiveWrapper",componentId:"pxxumo-1"})(["margin:0 ","px;border-radius:15px;border:7px solid #008b8b;"],5),Qi=Object(k.default)(Xi.a).withConfig({displayName:"Room__CascadeWrapper",componentId:"pxxumo-2"})(["color:white;overflow:hidden;position:relative;background:",";cursor:pointer;border-radius:8px;width:calc(100% - 30px);height:100px;margin:12px 15px;@media screen and (max-width:","){width:calc(100% - 10px);margin:12px 5px;}@media screen and (max-height:500px){height:70px;}"],pe.borderColor,B.mobileWidth),en=Object(k.default)(Qi).withConfig({displayName:"Room__CascadeActiveWrapper",componentId:"pxxumo-3"})(["border-radius:15px;border:7px solid #008B8B;height:150px;width:calc(100% - 20px);margin:5px 10px;@media screen and (max-width:","){width:100%;margin:12px 0;}@media screen and (max-height:500px){height:85px;}"],B.mobileWidth),tn=k.default.img.withConfig({displayName:"Room__DefaultRoomImage",componentId:"pxxumo-4"})(["position:absolute;top:0;left:0;height:100%;width:100%;object-fit:cover;transition:all 0.3s;&:hover{transform:scale(1.1);transition:all 0.3s;}"]),nn=Object(k.default)(tn).withConfig({displayName:"Room__CascadeRoomImage",componentId:"pxxumo-5"})(["object-fit:cover;&:hover{transform:scale(1.1);transition:all 0.3s;left:-5%;}"]),on=k.default.div.withConfig({displayName:"Room__RoomTitle",componentId:"pxxumo-6"})(["position:absolute;top:4px;left:4px;width:auto;background:rgba(0,0,0,0.6);padding:4px 10px;border-radius:12px;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:",";"],(function(e){return e.active?"178px":"192px"})),an=function(e){var t=e.theme,i=e.selectedImage,n=e.image,o=e.index,a=(e.prevIndex,e.clickScene),r=e.changingSeen,s=i&&n.url===i.url,c=s?$i:Zi,l=tn;switch(t){case"cascade":l=nn,c=s?en:Qi}return S.a.createElement(c,{delay:0,active:s,index:r?-1:Math.abs(o-i.index)},S.a.createElement(xi,null,S.a.createElement(Ci,{icon:O.a})),S.a.createElement(l,{src:n.thumbUrl||n.url,onClick:function(){return a(n,i.index)},alt:""}),S.a.createElement(on,{active:s},n.title))},rn=k.default.div.withConfig({displayName:"Content__Wrapper",componentId:"sc-1f91ule-0"})(["height:100%;overflow-x:scroll;overflow-y:hidden;display:flex;margin:",';::-webkit-scrollbar-thumb{-webkit-border-radius:20px;border-radius:20px;background:transparent;box-shadow:inset 0 0 13px white;-webkit-box-shadow:inset 0 0 13px white;}::-webkit-scrollbar{height:12px;}-webkit-mask-image:linear-gradient(to right,transparent 2px,black 50px,black calc(100% - 50px),transparent calc(100% - 2px));mask-image:linear-gradient(to right,transparent 2px,black 50px,black calc(100% - 50px),transparent calc(100% - 2px));&:after{content:"012";display:block;height:1px;opacity:0;}'],(function(e){return"flow"===e.theme?"0 -20px":"0 -100px"})),sn=k.default.div.withConfig({displayName:"Content__CascadeWrapper",componentId:"sc-1f91ule-1"})(["height:100%;width:100%;overflow-x:hidden;overflow-y:scroll;margin:0;padding:0 0 0 2px;::-webkit-scrollbar-thumb{-webkit-border-radius:20px;border-radius:20px;background:transparent;box-shadow:inset 0 0 13px white;-webkit-box-shadow:inset 0 0 13px white;}::-webkit-scrollbar{height:12px;}-webkit-mask-image:linear-gradient(to top,transparent 2px,black 50px,black calc(100% - 50px),transparent calc(100% - 2px) );mask-image:linear-gradient(to top,transparent 2px,black 50px,black calc(100% - 50px),transparent calc(100% - 2px) );&:before{content:'123';display:block;height:20px;opacity:0;}&:after{content:'123';display:block;height:0px;opacity:0;}"]),cn=function(e){var t=e.tour,i=e.selectedImage,n=e.index,o=e.reelVisible,a=t&&"cascade"===t.theme?sn:rn;return S.a.createElement(a,{id:"reel-content",show:o,theme:t?t.theme:"classic"},Array.isArray(t?t.images:null)&&t.images.filter((function(e){return void 0===e.hideFromRibbon||!e.hideFromRibbon})).map((function(o,a){return S.a.createElement(an,y()({},e,{index:a,image:o,selectedImage:y()({},i,{index:n}),theme:t?t.theme:"classic"}))})))},ln=k.default.div.withConfig({displayName:"Toggle__Wrapper",componentId:"sc-1cxpq0z-0"})(["width:80px;height:fit-content;border-radius:13px;text-align:center;display:flex;align-items:center;justify-content:center;z-index:100;background:rgba(0,0,0,.75);cursor:pointer;",";&:hover{background:rgba(0,0,0,.85);}"],(function(e){return e.reelvisible?"margin-bottom: 0;\n      transition: all  500ms;":"margin-bottom: -15px;\n      transition: all 300ms;"})),dn=k.default.div.withConfig({displayName:"Toggle__CascadeWrapper",componentId:"sc-1cxpq0z-1"})(["width:20px;height:80px;border-radius:13px;text-align:center;display:flex;align-items:center;justify-content:center;z-index:1000;background:rgba(0,0,0,.6);cursor:pointer;&:hover{background:rgba(0,0,0,.8);}"]),pn=Object(k.default)(_.a).withConfig({displayName:"Toggle__Arrow",componentId:"sc-1cxpq0z-2"})(["color:white;font-size:20px;"]),un=function(e){var t=e.toggleReel,i=e.reelvisible,n=e.isCascade,o=ln,a=i?ei.a:$t.a;return n&&(o=dn,a=i?ii.a:oi.a),S.a.createElement(o,{onClick:t,reelvisible:i},S.a.createElement(pn,{icon:a}))},mn=k.default.div.withConfig({displayName:"Arrow__Wrapper",componentId:"sc-1st9qyn-0"})(["display:flex;text-align:center;margin-bottom:18px;align-items:center;justify-content:center;z-index:",";margin:0 15px 18px;cursor:pointer;transition:all  500ms;",""],(function(e){return e.show?100:-1}),(function(e){return!e.show&&"opacity: 0;"})),hn=Object(k.default)(mn).withConfig({displayName:"Arrow__ModernWrapper",componentId:"sc-1st9qyn-1"})(["background:rgba(0,0,0,.6);width:60px;border-radius:13px;margin:0;&:hover{background:rgba(0,0,0,.8);}"]),fn=Object(k.default)(mn).withConfig({displayName:"Arrow__FlowWrapper",componentId:"sc-1st9qyn-2"})(["@media screen and (max-width:","){padding:5px;margin:0 10px 18px;}"],B.mobileWidth),gn=Object(k.default)(mn).withConfig({displayName:"Arrow__CascadeWrapper",componentId:"sc-1st9qyn-3"})(["margin:0;"]),wn=Object(k.default)(_.a).withConfig({displayName:"Arrow__Icon",componentId:"sc-1st9qyn-4"})(["color:white;font-size:",";text-shadow:3px 3px black;@media screen and (max-width:","){font-size:",";}@media screen and (max-width:","){font-size:",";}"],(function(e){return e.size||"40px"}),B.mobileWidth,(function(e){return e.size||"28px"}),B.xsMobileWidth,(function(e){var t=e.size,i=e.theme;return t||"flow"===i&&"20px"})),bn=function(e){var t=e.icon,i=e.onClick,n=e.show,o=e.size,a=e.theme,r="modern"===a?hn:"flow"===a?fn:"cascade"===a?gn:mn;return S.a.createElement(r,{show:n,onClick:function(){return n&&i()}},S.a.createElement(wn,{icon:t,size:o,show:n,theme:a}))},vn=function(e){var t=e.clickPrevArrow,i=e.tour,n=e.reelVisible,o=e.firstRoom;return S.a.createElement(bn,{show:i&&"modern"===i.theme&&n&&!o,onClick:t,icon:ii.a,size:"18px",theme:i?i.theme:"classic"})},yn=function(e){var t=e.clickNextArrow,i=e.tour,n=e.reelVisible,o=e.lastRoom;e.prevIndex;return S.a.createElement(bn,{show:i&&"modern"===i.theme&&n&&!o,onClick:t,icon:oi.a,size:"18px",theme:i?i.theme:""})},xn=k.default.div.withConfig({displayName:"Controls__Wrapper",componentId:"rt2u1r-0"})(["width:100%;padding:0 80px;display:flex;justify-content:space-between;height:20px;@media screen and (max-width:","){padding:0 30px;}"],B.smallMobileWidth),Cn=k.default.div.withConfig({displayName:"Controls__CascadeWrapper",componentId:"rt2u1r-1"})(["position:absolute;height:80px;left:calc(100% + 10px);width:20px;display:flex;justify-content:center;align-items:center;top:calc(50% - 40px);@media screen and (max-width:","){left:calc(100% + 2px);}"],B.smallMobileWidth),In=k.default.div.withConfig({displayName:"Controls__Middle",componentId:"rt2u1r-2"})(["display:flex;"]),Sn=function(e){var t=e.reelVisible,i=e.isCascade,n=e.clickToggleReel,o=i?Cn:xn;return S.a.createElement(o,null,S.a.createElement(vn,e),S.a.createElement(In,null,S.a.createElement(un,{toggleReel:n,reelvisible:t,isCascade:i})),S.a.createElement(yn,e))},En=function(e){var t=e.clickNextArrow,i=e.tour,n=e.reelVisible,o=e.lastRoom;return S.a.createElement(bn,{show:i&&"flow"===i.theme&&n&&!o,onClick:t,icon:oi.a,theme:i?i.theme:"classic"})},kn=function(e){var t=e.clickPrevArrow,i=e.tour,n=e.reelVisible,o=e.firstRoom;return S.a.createElement(bn,{show:i&&"flow"===i.theme&&n&&!o,onClick:t,icon:ii.a,theme:i?i.theme:"classic"})},_n=k.default.div.withConfig({displayName:"CascadeUpArrow__Wrapper",componentId:"feh76p-0"})(["margin:0 0 -10px 0;z-index:100;padding:0 10px 0 0;"]),Tn=function(e){var t=e.clickPrevArrow,i=e.tour,n=e.reelVisible,o=e.firstRoom;return S.a.createElement(_n,null,S.a.createElement(bn,{show:i&&"cascade"===i.theme&&n&&!o,onClick:t,icon:$t.a,theme:i?i.theme:"classic"}))},On=k.default.div.withConfig({displayName:"CascadeDownArrow__Wrapper",componentId:"sc-6qiwth-0"})(["margin:-10px 0 0 0;z-index:100;padding:0 10px 10px 0;@media screen and (max-width:","){padding:0;}"],B.mobileWidth),Nn=function(e){var t=e.clickNextArrow,i=e.tour,n=e.reelVisible,o=e.lastRoom;return S.a.createElement(On,null,S.a.createElement(bn,{show:i&&"cascade"===i.theme&&n&&!o,onClick:t,icon:ei.a,theme:i?i.theme:"classic"}))},Pn=Object(k.default)(Xi.a).withConfig({displayName:"Component__Wrapper",componentId:"sc-19pe9m0-0"})(["position:absolute;z-index:1;bottom:10px;left:0;width:100%;display:flex;flex-direction:column;align-items:center;"]),Rn=Object(k.default)(Pn).withConfig({displayName:"Component__CascadeWrapper",componentId:"sc-19pe9m0-1"})(["left:0;top:0;bottom:0;display:flex;flex-direction:column;align-items:center;background:rgba(0,0,0,.75);border-radius:0;padding:0 0 0 10px;",";@media screen and (max-width:","){max-width:calc(100% - 80px);}"],(function(e){return e.show?"width: 280px;\n      opacity: 1;\n      transition: all  500ms;":"width: 0;\n      opacity: 0;\n      transition: all 400ms;\n      padding: 0;"}),B.mobileWidth),An=k.default.div.withConfig({displayName:"Component__FlowTheme",componentId:"sc-19pe9m0-2"})(["height:140px;background:rgba(0,0,0,.6);width:fit-content;max-width:calc(100% - 200px);margin:8px 0 0;border-radius:40px;padding:6px 0 0;display:flex;",";@media screen and (max-height:640px){height:115px;","}@media screen and (max-width:","){max-width:calc(100% - 30px);}"],(function(e){return e.show?"height: 140px;\n      opacity: 1;\n      transition: all  500ms;":"height: 0;\n      opacity: 0;\n      transition: all 300ms;"}),(function(e){return e.show?"height: 115px;":"height: 0;"}),B.mobileWidth),Vn=Object(k.default)(An).withConfig({displayName:"Component__ModernTheme",componentId:"sc-19pe9m0-3"})(["width:100%;padding:6px 80px 0;max-width:unset;border-radius:0;margin-bottom:-10px;"]),jn=Object(k.default)(An).withConfig({displayName:"Component__CascadeTheme",componentId:"sc-19pe9m0-4"})(["height:100%;min-height:60%;background:transparent;width:100%;max-width:100%;margin:8px 0 0;border-radius:40px;padding:0;display:flex;flex-direction:column;"]),Dn=function(e){var t=e.reelVisible,i=e.tour,n=i&&"cascade"===i.theme,o=n&&i&&i.theme?jn:i&&"flow"===i.theme?An:Vn,a=n?Rn:Pn;return S.a.createElement(a,{show:t},S.a.createElement(Sn,y()({},e,{isCascade:n})),S.a.createElement(o,{show:t},!n&&S.a.createElement(kn,e),n&&S.a.createElement(Tn,e),S.a.createElement(cn,e),n&&S.a.createElement(Nn,e),!n&&S.a.createElement(En,e)))};function Ln(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h()(e);if(t){var o=h()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return u()(this,i)}}var Hn=function(e){d()(i,e);var t=Ln(i);function i(){var e;return o()(this,i),(e=t.call(this)).state={index:0,prevIndex:0,changingSeen:!1},e}return r()(i,[{key:"componentWillReceiveProps",value:function(e){var t=e.tour,i=e.selectedImage,n=e.reelVisible,o=t&&t.images.indexOf(t.images.find((function(e){return e===i})));this.setState({index:o});var a=document.getElementById("reel-content"),r=(window.innerWidth<=450?140:window.innerWidth<=812?160:200)+10;if(a&&(a.scrollLeft=r*o+(window.innerWidth>450?-r/2:t&&"flow"===t.theme?10:t&&"modern"===t.theme?-10:0)),t&&"cascade"===t.theme){var s=100;window.innerHeight<=500&&(s=70);var c=(s+12)*o;a&&(a.scrollTop=c)}else n&&t&&"cascade"!==t.theme&&(a.style.display="flex")}},{key:"clickScene",value:function(e,t){this.setState({prevIndex:t,changingSeen:!0}),this.props.setScene(e)}},{key:"clickToggleReel",value:function(){this.setState({prevIndex:-1,changingSeen:!1}),this.props.toggleReel()}},{key:"clickNextArrow",value:function(){this.setState({changingSeen:!0}),this.props.selectNextImage()}},{key:"clickPrevArrow",value:function(){this.setState({changingSeen:!0}),this.props.selectPreviousImage()}},{key:"render",value:function(){return!this.props.vr&&S.a.createElement(Dn,y()({},this.props,{clickScene:this.clickScene.bind(this),index:this.state.index,prevIndex:this.state.prevIndex,clickToggleReel:this.clickToggleReel.bind(this),clickNextArrow:this.clickNextArrow.bind(this),clickPrevArrow:this.clickPrevArrow.bind(this),changingSeen:this.state.changingSeen}))}}]),i}(I.Component),zn=i(901),Fn=i(909),Mn=i(768),Un=i(908),Wn=k.default.div.withConfig({displayName:"FloorplanPanel__Wrapper",componentId:"sc-1hj59mu-0"})([""," background:rgba(20,20,20,0.5);height:150px;margin-top:15px;padding:15px 12px 2px;border-radius:8px;max-width:593px;min-width:100px;position:relative;z-index:1;@media screen and (max-width:611px){max-width:394px;}"],(function(e){return!e.show&&"display: none;"})),Bn=k.default.div.withConfig({displayName:"FloorplanPanel__ImageListContainer",componentId:"sc-1hj59mu-1"})(["display:flex;height:150px;height:100%;overflow-y:hidden;overflow-x:scroll;::-webkit-scrollbar-thumb{-webkit-border-radius:10px;border-radius:10px;background:transparent;-webkit-box-shadow:inset 0 0 10px white;}::-webkit-scrollbar{height:12px;}"]),qn=k.default.div.withConfig({displayName:"FloorplanPanel__ImageContainer",componentId:"sc-1hj59mu-2"})(["height:100%;padding-right:15px;position:relative;min-width:180px;max-width:180px;overflow:hidden;background:white;margin:0 5px;border-radius:10px;display:flex;cursor:pointer;",""],(function(e){return e.isDisabled?Object(k.css)(["pointer-events:none;opacity:",";"],pe.disabledOpacity):null})),Jn=k.default.div.withConfig({displayName:"FloorplanPanel__FloorplanName",componentId:"sc-1hj59mu-3"})(["position:absolute;margin:5px;display:block;max-width:150px;white-space:nowrap;text-overflow:ellipsis;background:rgba(0,0,0,",");color:white;border-radius:10px;padding:2px 10px;font-size:13px;overflow:hidden;"],(function(e){return e.selected?"0.55":"0.4"})),Kn=k.default.img.withConfig({displayName:"FloorplanPanel__Image",componentId:"sc-1hj59mu-4"})(["height:100%;border-radius:4px;margin:auto;"]),Gn=k.default.div.withConfig({displayName:"FloorplanPanel__Triangle",componentId:"sc-1hj59mu-5"})(["position:absolute;top:-10px;left:12px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:10px solid rgba(20,20,20,0.5);"]),Yn=function(e){var t=e.floorplanPanel,i=e.tourFloorplans,n=e.setFloorplanModalView,o=e.openModal,a=e.isDisabled,r=void 0!==a&&a;return S.a.createElement(Wn,{show:t},S.a.createElement(Gn,null),S.a.createElement(Bn,null,i.map((function(e){return S.a.createElement(qn,{key:e.floorplanId,onClick:function(){!function(e){r||(n(e),o("floor-plan-link-to-rooms"))}(e)},isDisabled:r},S.a.createElement(Jn,null,e.name),S.a.createElement(Kn,{src:e.thumbUrl||e.url}))}))))},Xn=i(907),Zn=i.n(Xn),$n=k.default.div.withConfig({displayName:"LeadgenIcon__Wrapper",componentId:"sc-77i5wz-0"})([""," width:40px;height:40px;margin-bottom:5px;"],(function(e){return e.hidden&&"display: none;"})),Qn=k.default.div.withConfig({displayName:"LeadgenIcon__IconWrapper",componentId:"sc-77i5wz-1"})(["display:flex;justify-content:center;align-items:center;color:",";width:100%;height:40px;font-size:20px;background:rgba(0,0,0,.6);border-radius:12px;cursor:pointer;&:hover{background:rgba(0,0,0,0.6);}",""],(function(e){return e.iconColor||"white"}),(function(e){return e.isDisabled?Object(k.css)(["pointer-events:none;opacity:",";"],pe.disabledOpacity):null})),eo=Object(E.connect)((function(e){return{viewerStr:e.app.localization.viewerStr}}),null)((function(e){var t=e.openModal,i=e.tour,n=e.vr,o=e.isDisabled,a=void 0!==o&&o,r=e.viewerStr,s=-1!==window.location.search.indexOf("mls=1");return S.a.createElement($n,{hidden:!i.leadgen||!i.leadgen.enabled||n||s},S.a.createElement(ue.a,{title:r.requestInformation,position:"right",isDisabled:a},S.a.createElement(Qn,{onClick:function(){a||t("leadgen")},title:r.requestInformation,isDisabled:a},S.a.createElement(_.a,{icon:Zn.a}))))})),to=k.default.div.withConfig({displayName:"FloorplanIcon__Wrapper",componentId:"iwmhix-0"})([""," width:40px;height:40px;"],(function(e){return e.hidden&&"display: none;"})),io=k.default.div.withConfig({displayName:"FloorplanIcon__IconWrapper",componentId:"iwmhix-1"})(["display:flex;justify-content:center;align-items:center;color:",";width:100%;height:40px;font-size:20px;background:rgba(0,0,0,.6);border-radius:12px;cursor:pointer;&:hover{background:rgba(0,0,0,0.6);}",""],(function(e){return e.iconColor||"white"}),(function(e){return e.isDisabled?Object(k.css)(["pointer-events:none;opacity:",";"],pe.disabledOpacity):null})),no=k.default.img.withConfig({displayName:"FloorplanIcon__Icon",componentId:"iwmhix-2"})(["width:1em;"]),oo=Object(E.connect)((function(e){return{viewerStr:e.app.localization.viewerStr}}),null)((function(e){var t=e.toggleFloorplanPanel,i=e.tourFloorplans,n=e.vr,o=e.isDisabled,a=void 0!==o&&o;return S.a.createElement(to,{hidden:!i||i&&0===i.length||n},S.a.createElement(ue.a,{title:e.viewerStr.floorplans,position:"right",isDisabled:a},S.a.createElement(io,{onClick:function(){a||t()},title:e.viewerStr.viewFloorplans,isDisabled:a},S.a.createElement(no,{src:"./assets/img/floor-plan-icon.png"}))))})),ao=k.default.div.withConfig({displayName:"LeftIcons__Wrapper",componentId:"sc-17x0rmn-0"})(["position:absolute;left:15px;height:100px;z-index:5;bottom:9.5em;"]),ro=function(e){var t=e.isHide,i=void 0!==t&&t,n=Ct()(e,["isHide"]);return!i&&S.a.createElement(ao,null,S.a.createElement(eo,y()({},n,{noPageHeader:!0})),S.a.createElement(oo,y()({},n,{noPageHeader:!0})),S.a.createElement(Yn,n))},so=i(6);function co(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h()(e);if(t){var o=h()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return u()(this,i)}}var lo=function(e){return{action:e.app.action,data:e.tourViewer.data,error:e.app.error,loading:e.tourViewer.loading,modal:e.tourViewer.modal,modalMeta:e.tourViewer.modalMeta,reelVisible:e.tourViewer.reelVisible,selectedImage:e.tourViewer.selectedImage,selectedAsset:e.tourEditor.selectedAsset,user:e.app.user,vr:e.tourViewer.vr,selectedInfospot:e.tourEditor.selectedInfospot,sound:e.app.sound,imageLoadingProgress:e.app.imageLoadingProgress,floorplanPanel:e.tourViewer.floorplanPanel,tourFloorplans:e.app.tourFloorplans,passwordEnteredAndValid:e.tourViewer.passwordEnteredAndValid,scheduleShowingForm:e.tourViewer.scheduleShowingForm,commonStr:e.app.localization.commonStr,viewerStr:e.app.localization.viewerStr}},po=function(e){return{selectInfospot:function(t){return e(Object(Xt.f)(t))},fetchTour:function(t){return e(function(e){return function(){var t=C()(b.a.mark((function t(i){var n,o,a,r,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.fetch("/api/tours/".concat(e),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"JWT ".concat(Object(B.User)().token)}});case 2:return n=t.sent,t.next=5,n.json();case 5:if(o=t.sent,V()(o)){t.next=13;break}return"{}",a=R()(o,"config","{}")||"{}",r=JSON.parse(a),s={id:o.id||"invalid",shortId:o.shortId,name:o.name,logo:o.logo||!1,companyName:o.companyName,description:o.description,userId:o.userId,email:o.email,title:o.title,hideLogo:o.hideLogo,contacts:o.contacts&&JSON.parse(o.contacts)||{person:"",email:"",number:""},images:o.images&&JSON.parse(o.images),type:o.type,owner:o.owner,defaultHotspotStyle:o.defaultHotspotStyle||2,defaultHotspotImage:o.defaultHotspotImage||null,socialImage:o.socialImage||"https://".concat(B.domain.production,"/api/meta/").concat(o.shortId,"/centerimage.png"),whiteLabelUrl:o.whiteLabelUrl,whiteLabelStatusCode:o.whiteLabelStatusCode,leadgen:o.leadgen&&JSON.parse(o.leadgen),ua:o.ua,privacy:o.privacy,config:{enableRibbon:!o.config||null==JSON.parse(o.config).enableRibbon||JSON.parse(o.config).enableRibbon,tinyPlanet:!(!o.config||null==JSON.parse(o.config).tinyPlanet)&&JSON.parse(o.config).tinyPlanet,hideRibbonAtStart:!(!o.config||null==JSON.parse(o.config).hideRibbonAtStart)&&JSON.parse(o.config).hideRibbonAtStart,audioHotspots:!(!o.config||null==JSON.parse(o.config).audioHotspots)&&JSON.parse(o.config).audioHotspots,lockHorizontalFov:!(!o.config||null==JSON.parse(o.config).lockHorizontalFov)&&JSON.parse(o.config).lockHorizontalFov,autoRotate:!o.config||null==JSON.parse(o.config).autoRotate||JSON.parse(o.config).autoRotate,autoRotateSpeed:o.config&&null!=JSON.parse(o.config).autoRotateSpeed&&JSON.parse(o.config).autoRotateSpeed,ambience:o.config&&null!=JSON.parse(o.config).ambience?JSON.parse(o.config).ambience:void 0,toggleHotspots:!(!o.config||null==JSON.parse(o.config).toggleHotspots)&&JSON.parse(o.config).toggleHotspots,isHideShareButton:r.isHideShareButton||!1},isVideoChatEnabled:o.isVideoChatEnabled,theme:o.theme||"classic",isNotifyEnabled:!!o.isNotifyEnabled||!1,isScheduleEnabled:!!o.isScheduleEnabled||!1,agentName:o.agentName||"",agentEmail:o.agentEmail||"",isLinkbackEnabled:!!o.isLinkbackEnabled||!1},i(Kt(s)),t.abrupt("return",s);case 13:return t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t))},setTour:function(t){e(Kt(t))},openModal:function(t){e(Gt(t))},closeModal:function(){e(Yt())},setReel:function(t){e(function(e){return{type:Jt.n,reelVisible:e}}(t))},toggleReel:function(){e({type:Jt.s})},hideReel:function(){e({type:Jt.e})},toggleVR:function(){e({type:Jt.t})},startAction:function(t){return e(Object(Ut.w)(t))},showErrorNotification:function(t){return e(Object(Ut.u)(t))},hideErrorNotification:function(){return e(Object(Ut.i)())},selectImage:function(t){e(function(e){return{type:Jt.k,image:e}}(t))},share:function(){alert('<iframe onload="this.width=screen.width/2;this.height=screen.height/2;" src="'.concat(window.location.href,'"></iframe>'))},startLoad:function(){return e({type:Jt.p})},loadSuccess:function(){return e({type:Jt.f})},finishAction:function(){return e(Object(Ut.f)())},setUser:function(t){return e(Object(Ut.s)(t))},submitEmail:(t=C()(b.a.mark((function t(i){var n,o,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i.email,o=i.tour,!n.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/)){t.next=12;break}return Object(Ut.w)((void 0).props.viewerStr.verifyngEmailPleaseWait),a=y()({},o,{email:n,type:"locked-with-email"}),e(Kt(a)),t.next=8,uploadValidTour(a)(e);case 8:t.sent?(e(Kt(a)),Object(Ut.f)()):console.log("Error updating tour"),t.next=13;break;case 12:alert((void 0).props.viewerStr.invalidEmail);case 13:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)}),dispatchError:function(t){return e(Object(Ut.u)({message:t}))},changeEmail:function(t){return e(Object(Ut.a)(t.target.value))},close:function(){return e(closePaymentsModal())},openShareAndEmbed:function(t){e({type:Jt.l,meta:t}),e(Gt("shareAndEmbed"))},exitFree:function(){return e(Yt())},exitPaid:function(t,i){return function(){var n=C()(b.a.mark((function n(o){var a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e(Object(Ut.w)(i)),a=y()({},t,{type:"paid"}),e(Kt(a)),n.next=5,fetch("/api/tours/".concat(t.id,"/unlock/paid"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"JWT ".concat(Object(B.User)().token)}});case 5:e(Object(Ut.f)()),e(Yt());case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},setAmbienceAudio:function(t){return e(Object(Ut.setAmbienceAudio)(t))},setAmbiencePlaying:function(t,i){i.pause(),e(Object(Ut.p)(t,i))},toggleFloorplanPanel:function(){return e({type:Jt.r})},fetchFloorplans:function(t){return e(Object(Ut.d)(t))},setFloorplanModalView:function(t){return e(Object(Ut.q)(t))},changeActiveTab:function(t){return e(Object(Xt.a)(t))},setImageLoadingProgress:function(t){return e(Object(Ut.r)(t))},setPasswordEnteredAndValid:function(){return e({type:Jt.m})},updateScheduleForm:function(t){return e(function(e){return{type:Jt.u,data:e}}(t))}};var t},uo=!1,mo=null,ho=function(e){d()(s,e);var t,i,n,a=co(s);function s(e){var t;return o()(this,s),t=a.call(this,e),g()(c()(t),"setAudio",(function(){t.props.setAmbiencePlaying(!0,t.props.sound.ambience.audio||new Audio("./assets/sound/ambience.mp3")),window.removeEventListener("click",t.setAudio),window.removeEventListener("keydown",t.setAudio)})),g()(c()(t),"findInitialViewOverride",(function(e){var i,n=t.props.selectedImage&&t.props.selectedImage.id;return e.initialViewOverrides&&e.initialViewOverrides.length>0&&(i=e.initialViewOverrides.filter((function(e){return e.id==n}))[0]),i})),g()(c()(t),"createAndSetupPanorama",(function(e,i){var n,o=t.checkIs2DImage(e);return n=t.props.tour&&t.props.tour.config.tinyPlanet?new window.PANOLENS.ImageLittlePlanet(i):o?new window.PANOLENS.SliderPanorama(i):new window.PANOLENS.ImagePanorama(i),t.props.tour&&!t.props.tour.config.tinyPlanet&&(t.addInfospotsToPanorama(e,n),t.addHotspotsToPanorama(e,n)),n})),g()(c()(t),"addInfospotsToPanorama",(function(e,i){var n=t.props.commonStr,o=t.spotsSizes(i).infospotSize;e.infospots&&e.infospots.length>0&&e.infospots.forEach((function(e){if(t.checkIsShouldAddSpot(i,e)){var a=B.InfospotStyles[e.style]?B.InfospotStyles[e.style]:e.style,r=new window.PANOLENS.Infospot(o,a);if(r.position.set(e.coords.x,e.coords.y,e.coords.z),"shrt"==e.dataType&&e.data)r.addHoverText(e.data);else if("ext"==e.dataType&&e.data){var s=Object(B.convertStringToHtmlElement)(Object(B.getExtendedInfospot)(e.data));r.addHoverElement(s,120)}else if("html"==e.dataType&&e.data){var l=R()(e,"data.previewText",n.clickToView)||n.clickToView;r.addHoverText(l),r.addEventListener("click",t.handleHtmlInfospotOpenByClick.bind(c()(t),e))}else if("image"==e.dataType){var d=R()(e,"data.previewText",n.clickToView);r.addHoverText(d||n.clickToView),r.addEventListener("click",t.handleHtmlInfospotOpenByClick.bind(c()(t),e))}else"hyperLink"==e.dataType&&e.data&&(r.addHoverText(e.data.previewText),r.addEventListener("click",(function(){var t=e.data.url.match("(https://*)|(http://*)")?e.data.url:"http://"+e.data.url;e.data.targetBlank?window.open(t,"_blank"):window.location.assign(t)})));r.addEventListener("hoverenter",(function(){t.props.tour.config.audioHotspots&&t.props.sound.hover.play()})),r.addEventListener("click",(function(){t.props.tour.config.audioHotspots&&t.props.sound.click.play()})),r.type="infospot",i.add(r)}}))})),g()(c()(t),"addHotspotsToPanorama",(function(e,i){var n=t.spotsSizes(i).hotspotSize;e.hotspots&&e.hotspots.length>0&&e.hotspots.forEach((function(e){if(t.checkIsShouldAddSpot(i,e)&&e.image){var o=e.style?e.style:t.props.tour.defaultHotspotStyle,a=new window.PANOLENS.Infospot(n,o==so.m.HOTSPOT_PREVIEW_IMG?e.image.hotspotUrl:o==so.m.WHITE_ARROW?"./assets/img/hotspot-icon-white.png":o==so.m.BLACK_ARROW?"./assets/img/hotspot-icon-black.png":o==so.m.CUSTOM_IMG?e.image.url:"./assets/img/hotspot-icon-white.png");e.rotation&&(a.material.rotation=e.rotation*Math.PI/180),a.position.set(e.coords.x,e.coords.y,e.coords.z),a.addHoverText(e.image&&e.image.title||"Scene"),a.addEventListener("hoverenter",(function(){t.props.tour.config.audioHotspots&&t.props.sound.hover.play()})),a.addEventListener("click",(function(){t.state.isDisabledControls||(t.setScene(Object(B.withId)(t.props.tour.images)(e.image),null,null,!0),t.props.tour.config.audioHotspots&&t.props.sound.click.play())})),a.type="toScene",a.title=e.image.title,i.add(a)}}))})),g()(c()(t),"checkIsSkipSceneLoad",(function(e){var i=t.props,n=i.selectedImage,o=i.imageLoadingProgress,a=i.passwordEnteredAndValid,r=i.tour,s=i.user,c=(null==n?void 0:n.url)===(null==e?void 0:e.url),l=100!==o,d=!a&&"Password"===r.privacy&&r.userId!==s.id;return c||l||d})),g()(c()(t),"initiateViewerEnvironment",(function(e){var i=t.state.isTourViewTypeLegacy,n=t.props.tour.config&&t.props.tour.config.autoRotate,o=Object(B.getRotationSpeedForOrbitControls)(t.props.tour.config.autoRotateSpeed),a=R()(t.props,"tour.config.transitionType",null),r=t.calculateDefaultFovByTourType(i);t.viewerManager=t.createViewerManager({container:e,controlBar:!0,controlButtons:[],enableReticle:t.props.vr,autoHideInfospot:t.props.tour.config&&t.props.tour.config.toggleHotspots,defaultFov:r,horizontalView:t.props.tour.config&&t.props.tour.config.lockHorizontalFov,autoRotateActivationDuration:5e3,autoRotateSpeed:o,autoRotate:n,transitionParams:{type:a}}),t.viewer=t.createViewer(),t.isFirstViewerLoad=!0})),g()(c()(t),"createViewerManager",(function(e){return new window.PANOLENS.ViewerManager(y()({},e))})),g()(c()(t),"createViewer",(function(e){var i=t.calculateSceneFov();return new window.PANOLENS.Viewer(y()({},t.viewerManager.options,{cameraFov:i},e))})),g()(c()(t),"calculateSceneFov",(function(){var e=t.state.isTourViewTypeLegacy,i=t.calculateDefaultFovByTourType(e),n=t.props.selectedImage||t.props.tour.images[0];return R()(n,"cameraZoom",i)})),g()(c()(t),"clearViewerPanoramaResources",(function(){t.viewer.panorama&&t.viewer.panorama.children&&t.viewer.panorama.children.map((function(e){e.removeHoverElement&&e.removeHoverElement(),e.hide()}))})),g()(c()(t),"spotsSizes",(function(e){var i=t.state.isTourViewTypeLegacy,n=t.checkIsSliderPanorama(e),o=t.spotSizesByTourTypeAndNavigator(i),a=n?.2:o;if(B.mobileNavigator)return{hotspotSize:a,infospotSize:a};var r=n?.09:o;return{hotspotSize:r,infospotSize:r}})),g()(c()(t),"spotSizesByTourTypeAndNavigator",(function(e){return B.mobileNavigator?e?so.D.LEGACY.MOBILE:so.D.MODERN.MOBILE:e?so.D.LEGACY.DESKTOP:so.D.MODERN.DESKTOP})),g()(c()(t),"checkIs2DImage",(function(e){return!!(R()(e,"is2D",!1)||!1)})),g()(c()(t),"checkIsSliderPanorama",(function(e){return R()(e,"subtype",null)===so.r.SLIDER})),g()(c()(t),"checkIsShouldAddSpot",(function(e,i){var n=R()(i,"subtype",so.E[360]),o=t.checkIsSliderPanorama(e),a=n===so.E["2D"];return o&&a||!o&&!a})),g()(c()(t),"manageAutoRotationByPanoramaSubtype",(function(e){var i=t.state.isVideoChatStarted,n=t.props.tour.config&&t.props.tour.config.autoRotate;i||e?t.viewer.disableAutoRate():i||!n||e||t.viewer.enableAutoRate()})),g()(c()(t),"handleSetTokens",(function(e){return t.setState({stripeTokens:e})})),g()(c()(t),"addSceneIdToUrl",(function(e){var t=new URLSearchParams(j.history.location.search);t.delete("sceneId"),e&&t.set("sceneId",e);var i=t.toString();-1===j.history.location.pathname.indexOf("/edit")&&j.history.replace({pathname:j.history.location.pathname,search:i?"?".concat(i):null})})),t.state={redirect:!1,isDisabledControls:!1,isHideTourViewerControls:!1,isVideoChatStarted:!1,isVideoChatIconHide:!1,isVideoChatShow:!1,selectedInfospotId:null,stripeTokens:null,isTourViewTypeLegacy:!1},t}return r()(s,[{key:"initializeCustomUserAnalytics",value:function(e,t){e&&(0===e.toUpperCase().indexOf("UA-")?(N.a.initialize(e),N.a.pageview(t)):0===e.toUpperCase().indexOf("G-")&&window.gtag&&gtag("config",e))}},{key:"componentWillUnmount",value:function(){this.props.selectImage(null),-1!=window.location.pathname.indexOf("browse")&&this.props.setAmbiencePlaying(!1,this.props.sound.ambience.audio||new Audio("https://bigdatahomes.blob.core.windows.net/assets/ambience/".concat(this.props.tour.config.ambience,".mp3"))),this.viewer&&this.viewer.panorama&&this.viewer.panorama.dispose(),this.viewer&&this.viewer.panorama&&this.viewer.panorama.map&&this.viewer.panorama.dispose(),this.viewer&&this.viewer.renderer.dispose(),this.viewer&&this.viewer.renderer.forceContextLoss(),this.viewer=null,this.setDriftVisibilityStatus(!0)}},{key:"componentDidMount",value:(n=C()(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.addEventListener("fullscreenchange",this.onFullScreenChange.bind(this),!1),window.addEventListener("webkitfullscreenchange",this.onFullScreenChange.bind(this),!1),window.addEventListener("mozfullscreenchange",this.onFullScreenChange.bind(this),!1),-1!=window.location.search.indexOf("mls=1")&&(this.mlsCompliant=!0),e.next=6,this.runMountingActivities();case 6:R()(this.props,"tour.isVideoChatEnabled",!1)&&-1!==window.location.search.indexOf("showVideoChat=1")&&this.setState({isVideoChatShow:!0}),t=this.isTourViewTypeLegacy(this.props.tour),this.setState({isTourViewTypeLegacy:t});case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"runMountingActivities",value:(i=C()(b.a.mark((function e(){var t,i,n,o=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.addEventListener("resize",(function(){o.viewer.onWindowResize(o.pano.offsetWidth,o.pano.offsetHeight);var e=o;setTimeout((function(){e.viewer.onWindowResize(e.pano.offsetWidth,e.pano.offsetHeight)}),200)})),"invalid"!==this.props.tour.id){e.next=3;break}return e.abrupt("return");case 3:if(!(this.props.tour.images.length>0)){e.next=11;break}return t=Object(B.getViewerRibbonImages)(this.props.tour.images)[0],i=new URLSearchParams(j.history.location.search),(n=i.get("sceneId"))&&this.props.tour.images.length&&(t=this.props.tour.images.find((function(e){return e.id===n}))||t),console.log("should run first setscene"),e.next=11,this.setScene(t||(this.props.tour.images.length?this.props.tour.images[0]:null));case 11:if(this.props.tour.config.ambience&&(window.addEventListener("click",this.setAudio),window.addEventListener("keydown",this.setAudio)),(this.props.tour.config.hideRibbonAtStart&&this.props.reelVisible||!this.props.tour.config.hideRibbonAtStart&&!this.props.reelVisible)&&this.props.toggleReel(),!this.props.tour){e.next=20;break}if(!this.props.preview){e.next=16;break}return e.abrupt("return");case 16:this.initializeCustomUserAnalytics(this.props.tour.ua,this.props.tour.title),document.title="360 Tour - "+this.props.tour.title,this.checkLockStatus(),this.props.fetchFloorplans(this.props.tour);case 20:window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",this.handleOrientation,!1);case 21:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"checkLockStatus",value:function(){"locked"===this.props.tour.type&&this.props.tour.owner&&(this.props.tour.userId==this.props.user.id?2===this.props.tour.owner.type?this.props.openShareAndEmbed(this.props.tour):this.props.openModal("payments"):this.props.openModal("locked-tour"))}},{key:"handleOrientation",value:function(e){mo=e}},{key:"setCameraForStreaming",value:(t=C()(b.a.mark((function e(t,i,n){var o,a,r,s,c=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.state.isTourViewTypeLegacy,i===this.props.selectedImage.id){e.next=5;break}return a=this.props.tour.images.filter((function(e){return e.id===i}))[0],this.setScene(a,t,n),e.abrupt("return");case 5:o?(this.viewer.camera.position.set(t.x,t.y,t.z),this.viewer.control.update()):this.viewer.control.centerTo(t.h,t.v),r={fov:this.viewer.camera.fov},s=new TWEEN.Tween(r).to({fov:n},100).easing(TWEEN.Easing.Exponential.Out).onUpdate((function(){c.viewer.camera.fov=r.fov,c.viewer.camera.updateProjectionMatrix()})),this.viewer.camera.fov!==n&&s.start();case 9:case"end":return e.stop()}}),e,this)}))),function(e,i,n){return t.apply(this,arguments)})},{key:"exitFullscreen",value:function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}},{key:"setFullscreen",value:function(){this.panoContainer.requestFullscreen&&this.panoContainer.requestFullscreen(),this.panoContainer.msRequestFullscreen&&this.panoContainer.msRequestFullscreen(),this.panoContainer.mozRequestFullScreen&&this.panoContainer.mozRequestFullScreen(),this.panoContainer.webkitRequestFullscreen&&this.panoContainer.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}},{key:"onFullScreenChange",value:function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?(this.panoContainer.style.left=0,this.panoContainer.style.top=0,this.pano.style.top=0,this.pano.style.left=0,this.pano.style.width="100%",this.pano.style.height="100%",this.viewer.onWindowResize(this.pano.offsetWidth,this.pano.offsetHeight)):(this.pano.style.top="unset",this.pano.style.left="unset",this.panoContainer.style.top="unset",this.panoContainer.style.left="unset",this.pano.style.width=this.props.preview?"70vw":"100%",this.pano.style.height=this.props.preview?"70vh":"100%",this.viewer.onWindowResize(this.pano.offsetWidth,this.pano.offsetHeight))}},{key:"toggleVR",value:function(){this.props.toggleVR(),this.props.vr?(this.exitFullscreen(),this.viewer.disableEffect(),B.mobileNavigator&&(uo=!1,this.viewer.enableControl(2))):(this.setFullscreen(),this.viewer.camera.fov=1.1*this.viewer.camera.fov,this.viewer.enableEffect(PANOLENS.MODES.CARDBOARD),B.mobileNavigator&&(uo||this.toggleMotionConrol()),this.viewer.enableReticleControl())}},{key:"toggleUrlSearchParamShowVideoChat",value:function(e){var t=R()(this.props,"location.pathname",null),i=R()(this.props,"location.search",""),n=new URLSearchParams(i);e?n.set("showVideoChat",1):n.delete("showVideoChat");var o=n.toString();j.history.replace({pathname:t,search:o?"?".concat(o):null})}},{key:"toggleVideoChatView",value:function(){var e=this;this.state.isVideoChatStarted||this.setState((function(t){var i=!t.isVideoChatShow;return e.toggleUrlSearchParamShowVideoChat(i),{isVideoChatShow:i}}))}},{key:"toggleHideTourViewerControls",value:function(){this.setState((function(e){return{isHideTourViewerControls:!e.isHideTourViewerControls}}),this.toggleUIControls)}},{key:"setHideTourViewerControlsByChatStatus",value:function(){var e=this.state.isVideoChatStarted;this.setState({isHideTourViewerControls:e},this.toggleUIControls)}},{key:"setDriftVisibilityStatusByChatStatus",value:function(){var e=this.state.isVideoChatStarted;this.setDriftVisibilityStatus(!e)}},{key:"setDriftVisibilityStatus",value:function(e){try{var t=document.getElementById("drift-widget");if(!t)return;e?t.classList.remove("drift-widget--hide-controls"):t.classList.add("drift-widget--hide-controls")}catch(e){console.log(e)}}},{key:"toggleUIControls",value:function(){var e=this.state.isHideTourViewerControls;(0,this.props.setReel)(!e),this.setDriftVisibilityStatus(!e)}},{key:"setViewerAutorotateStatus",value:function(e){var t=this.props.selectedImage,i=R()(this.props,"tour.config.autoRotate",!1),n=this.checkIs2DImage(t);"boolean"==typeof e&&this.viewer&&this.viewer.OrbitControls&&(e&&i&&!n?this.viewer.enableAutoRate():this.viewer.disableAutoRate())}},{key:"setViewerAutorotateStatusByChatStatus",value:function(){var e=this.state.isVideoChatStarted;this.setViewerAutorotateStatus(!e)}},{key:"setVideoChatStatus",value:function(e){"boolean"==typeof e&&this.setState({isVideoChatStarted:e,isVideoChatShow:e},this.postProcessingSetVideoChatStatus)}},{key:"postProcessingSetVideoChatStatus",value:function(){var e=this.state.isVideoChatStarted;this.setViewerAutorotateStatusByChatStatus(),this.setHideTourViewerControlsByChatStatus(),this.setDriftVisibilityStatusByChatStatus(),e||this.toggleUrlSearchParamShowVideoChat(e)}},{key:"handleHtmlInfospotOpen",value:function(e){e&&(this.props.selectInfospot(e),this.props.openModal("htmlInfospotModal"));var t=R()(e,"id",null);this.setState({selectedInfospotId:t})}},{key:"handleHtmlInfospotOpenByClick",value:function(e){this.state.isDisabledControls||this.handleHtmlInfospotOpen(e)}},{key:"handleHtmlInfospotClose",value:function(){this.setState({selectedInfospotId:null}),this.props.closeModal()}},{key:"handleHtmlInfospotCloseByClick",value:function(){this.state.isDisabledControls||this.handleHtmlInfospotClose()}},{key:"setSelectedHtmlInfospot",value:function(e){var t="htmlInfospotModal"===R()(this.props,"modal",null);e||!t?this.handleHtmlInfospotOpen(e):this.handleHtmlInfospotClose()}},{key:"setScene",value:function(e,t,i){var n=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.checkIsSkipSceneLoad(e);if(!a){if(this.props.startLoad(),null==e||e&&!e.uploaded){var r=new window.PANOLENS.BasicPanorama;return this.props.selectImage(e),void(this.viewer&&(this.clearViewerPanoramaResources(),this.viewer=this.createViewer(),this.viewer.add(r),this.viewerManager.add(this.viewer),this.viewerManager.setScene(this.viewer)))}var s=Object(B.getViewerRibbonImages)(this.props.tour.images);this.addSceneIdToUrl(s[0].id!==e.id?e.id:null),PANOLENS.ImageLoader.load(e.url,(function(a){var r,s;if(a.width){var c=n.findInitialViewOverride(e),l=n.createAndSetupPanorama(e,a);if(a.src){var d=R()(n.props,"selectedImage",null),p=R()(d,"is2D",!1),u=R()(d,"cameraPosition",y()({},so.b.POSITION)),m=R()(d,"rotationInitialView",y()({},so.b.ROTATION)),h=R()(d,"rotationNorthPoint",y()({},so.b.ROTATION)),f=R()(n.viewer,"camera.position",y()({},so.b.POSITION)),g=(null===(r=n.viewer)||void 0===r||null===(s=r.control)||void 0===s?void 0:s.getRotations())||y()({},so.b.ROTATION);n.props.selectImage(e);var w=y()({},e,{isInitiatorInfospot:o,forceCoords:t,forceFov:i,initialViewOverride:c,prevImageIs2D:p,prevCameraPosition:u,prevRotationInitialView:m,prevRotationNorthPoint:h,prevCurrentCameraPosition:f,prevCurrentRotation:g});console.log("about to check"),n.isFirstViewerLoad||(n.clearViewerPanoramaResources(),n.viewer=n.createViewer()),n.isFirstViewerLoad=!1,n.addPanormaAndSetScene(l,w),n.props.loadSuccess()}}}),(function(e){n.props.setImageLoadingProgress(e.loaded/e.total*100)}),(function(e){return n.handleSetSceneError(e)}))}}},{key:"handleSetSceneError",value:function(e){console.log("Error:",e),this.setScene(null)}},{key:"addPanormaAndSetScene",value:function(e,t){var i=this.state.isTourViewTypeLegacy,n=this.checkIs2DImage(t);if(this.viewer.add(e),i){var o=t.initialViewOverride,a=t.cameraPosition,r=R()(o,"cameraPosition",a);this.setCameraPosition(r)}else{var s=this.calculateRotationByNavigationMode(t);this.setCameraRotation(s)}this.manageAutoRotationByPanoramaSubtype(n),this.viewer.control.noRotate=n,this.viewerManager.add(this.viewer),this.viewerManager.setScene(this.viewer)}},{key:"calculateRotationByNavigationMode",value:function(e){switch(R()(this.props,"tour.config.navigationMode",so.n.INITIAL_VIEW)){case so.n.HYBRID:return this.calculateRotationForHybridMode(e);case so.n.NORTH_POINT:return this.calculateRotationForNorthPointMode(e);case so.n.INITIAL_VIEW:default:return this.calculateRotationForInitialViewMode(e)}}},{key:"calculateRotationForInitialViewMode",value:function(e){return e.rotationInitialView||y()({},so.b.ROTATION)}},{key:"calculateRotationForNorthPointMode",value:function(e){var t=e.prevRotationNorthPoint,i=e.prevCurrentRotation,n=e.prevImageIs2D,o=R()(e,"rotationNorthPoint",y()({},so.b.ROTATION));if(!n){var a=t.h-o.h;return{h:i.h-a,v:i.v}}return{h:o.h,v:o.v}}},{key:"calculateRotationForHybridMode",value:function(e){return R()(e,"isInitiatorInfospot",!1)?this.calculateRotationForNorthPointMode(e):this.calculateRotationForInitialViewMode(e)}},{key:"isTourViewTypeLegacy",value:function(e){return R()(e,"images",[]).some((function(e){return!!e.cameraPosition}))}},{key:"setCameraPosition",value:function(e,t){var i=t||this.viewer,n=V()(e)?y()({},so.b.POSITION):e;i.camera.position.set(n.x,n.y,n.z)}},{key:"setCameraRotation",value:function(e,t){var i=this.props.selectedImage||this.props.tour.images[0];if(!this.checkIs2DImage(i)){var n=t||this.viewer,o=e||y()({},so.b.ROTATION);n.control.centerTo(o.h,o.v)}}},{key:"setCameraFov",value:function(e){this.viewer&&this.viewer.setCameraFov(e)}},{key:"setCameraToView",value:function(e){var t=y()({},so.b.POSITION),i=so.b.FOV;t=e.forceCoords?e.forceCoords:R()(e,"cameraPosition",null),i=e.forceFov?e.forceFov:R()(e,"cameraZoom",so.b.FOV)||so.b.FOV,this.setCameraPosition(t),this.setCameraFov(i)}},{key:"reenableVR",value:function(){this.props.vr&&this.viewer.enableEffect(PANOLENS.MODES.CARDBOARD)}},{key:"setPanoContainerRef",value:function(e){e&&(this.panoContainer=e)}},{key:"setPanoRef",value:function(e){e&&this.props.selectedImage&&!this.viewer&&(this.pano=e,this.initiateViewerEnvironment(this.pano))}},{key:"calculateDefaultFovByTourType",value:function(e){return e?so.b.FOV:so.b.FOV_MODERN}},{key:"setDisableViewerOrbitControls",value:function(){this.viewer&&this.viewer.OrbitControls&&this.viewer.OrbitControls.enabled&&this.viewerManager.setControlEnabled(!1)}},{key:"setEnableViewerOrbitControls",value:function(){this.viewer&&this.viewer.OrbitControls&&!this.viewer.OrbitControls.enabled&&this.viewerManager.setControlEnabled(!0)}},{key:"setDisableViewerSphericalControls",value:function(){this.viewer&&this.viewer.SphericalControls&&this.viewer.SphericalControls.enabled&&(this.viewer.SphericalControls.enabled=!1)}},{key:"setEnableViewerSphericalControls",value:function(){this.viewer&&this.viewer.SphericalControls&&!this.viewer.SphericalControls.enabled&&(this.viewer.SphericalControls.enabled=!0)}},{key:"setDisableControls",value:function(){this.setDisableViewerOrbitControls(),this.setDisableViewerSphericalControls(),this.setState({isDisabledControls:!0})}},{key:"setEnableControls",value:function(){this.setEnableViewerOrbitControls(),this.setEnableViewerSphericalControls(),this.setState({isDisabledControls:!1})}},{key:"selectNextImage",value:function(){var e=this,t="undefined"!==this.props.selectedImage.hideFromRibbon&&this.props.selectedImage.hideFromRibbon,i=Object(B.getViewerRibbonImages)(this.props.tour.images),n=t?[this.props.selectedImage]:i.filter((function(t){return t.id===e.props.selectedImage.id})),o=Object(B.indexById)(t?this.props.tour.images:i)(n[0])+1;o<(t?this.props.tour.images.length:i.length)&&this.setScene(t?this.props.tour.images[o]:i[o])}},{key:"selectPreviousImage",value:function(){var e=this,t="undefined"!==this.props.selectedImage.hideFromRibbon&&this.props.selectedImage.hideFromRibbon,i=Object(B.getViewerRibbonImages)(this.props.tour.images),n=t?[this.props.selectedImage]:i.filter((function(t){return t.id===e.props.selectedImage.id})),o=Object(B.indexById)(t?this.props.tour.images:i)(n[0])-1;o>=0&&this.setScene(t?this.props.tour.images[o]:i[o])}},{key:"toggleMotionConrol",value:function(){var e=this;if(uo=!uo)mo?this.viewer.enableControl(1):window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t&&(mo=!0,e.viewer.enableControl(1)),"granted"!=t&&(e.props.dispatchError(e.props.viewerStr.weCantReadMotionFrom),uo=!1)})).catch((function(){e.props.dispatchError(e.props.viewerStr.weCantReadMotionFrom),uo=!1})):(this.props.dispatchError(this.props.viewerStr.weCantReadMotionFrom),uo=!1);else{if("device-orientation"===this.viewer.control.id)this.state.isTourViewTypeLegacy?this.viewer.enableControl(0):this.viewer.enableControl(2);uo=!1}}},{key:"lastImage",value:function(){var e=this;if(this.props.selectedImage){if(this.props.tour.images){var t="undefined"!==this.props.selectedImage.hideFromRibbon&&this.props.selectedImage.hideFromRibbon,i=Object(B.getViewerRibbonImages)(this.props.tour.images);if(!i.length&&this.props.tour.images.length)return!0;var n=t?[this.props.selectedImage]:i.filter((function(t){return t.id===e.props.selectedImage.id}));return Object(B.indexById)(t?this.props.tour.images:i)(n[0])+1>=(t?this.props.tour.images.length:i.length)}return!1}}},{key:"firstImage",value:function(){var e=this;if(this.props.selectedImage){if(this.props.tour.images){var t="undefined"!==this.props.selectedImage.hideFromRibbon&&this.props.selectedImage.hideFromRibbon,i=Object(B.getViewerRibbonImages)(this.props.tour.images);if(!i.length&&this.props.tour.images.length)return!0;var n=t?[this.props.selectedImage]:i.filter((function(t){return t.id===e.props.selectedImage.id}));return Object(B.indexById)(t?this.props.tour.images:i)(n[0])-1<0}return!1}}},{key:"toggleAmbience",value:function(){this.sound.ambience&&this.sound.ambience.audio&&!this.sound.ambience.playing?(this.sound.ambience.playing=!0,this.sound.ambience.audio.play().loop()):(this.sound.ambience.playing=!1,this.sound.ambience.audio.pause())}},{key:"render",value:function(){var e,t=this,i=R()(this.props,"tour.isVideoChatEnabled",!1);return"Password"!=this.props.tour.privacy||this.props.passwordEnteredAndValid||this.props.tour.userId==this.props.user.id?S.a.createElement(xo,null,mo&&B.mobileNavigator&&uo?S.a.createElement(go,null,S.a.createElement(wo,{src:"./assets/img/rotate-mobile.png"}),S.a.createElement("div",null,this.props.viewerStr.moveOrTapYourPhone)):null,!mo&&B.mobileNavigator?S.a.createElement(go,null,S.a.createElement(wo,{src:"./assets/img/rotate-mobile.png"}),S.a.createElement("div",null,this.props.viewerStr.tapYourPhoneToExplore)):null,B.mobileNavigator?null:S.a.createElement(go,null,S.a.createElement(bo,{src:"./assets/img/rotate-desktop.png"}),S.a.createElement("div",null,this.props.viewerStr.clickAndDragMouseToExplore)),S.a.createElement("div",{ref:this.setPanoContainerRef.bind(this)},S.a.createElement("title",null,this.props.tour.title?this.props.tour.title:this.props.commonStr.title),this.props.preview?null:S.a.createElement("div",null,i&&this.state.isVideoChatShow&&S.a.createElement(Mt,{tourId:this.props.tour&&this.props.tour.shortId,sceneId:this.props.selectedImage&&this.props.selectedImage.id,setCameraForStreaming:function(e,i,n){return t.setCameraForStreaming(e,i,n)},viewer:this.viewer,setEnableControls:this.setEnableControls.bind(this),setDisableControls:this.setDisableControls.bind(this),setVideoChatStatus:this.setVideoChatStatus.bind(this),viewerProps:this.props,user:this.props.user,selectedInfospotId:this.state.selectedInfospotId,setSelectedHtmlInfospot:this.setSelectedHtmlInfospot.bind(this),isTourViewTypeLegacy:this.state.isTourViewTypeLegacy}),S.a.createElement(Yi,y()({},this.props,{setFullscreen:this.setFullscreen.bind(this),toggleMotionConrol:this.toggleMotionConrol.bind(this),toggleVR:this.toggleVR.bind(this),toggleVideoChatView:this.toggleVideoChatView.bind(this),toggleHideTourViewerControls:this.toggleHideTourViewerControls.bind(this),mlsCompliant:this.mlsCompliant,isVideoChatStarted:this.state.isVideoChatStarted,isDisabled:this.state.isDisabledControls,isHideTourViewerControls:this.state.isHideTourViewerControls}))),this.props.vr||this.mlsCompliant||this.state.isHideTourViewerControls?null:S.a.createElement(ai,{isCascade:"cascade"===this.props.tour.theme},vo(this.props.tour),S.a.createElement(si,null,S.a.createElement(ci,null,this.props.tour.contacts&&this.props.tour.contacts.person),S.a.createElement(li,{onClick:function(){return window.open("tel:".concat(t.props.tour.contacts&&t.props.tour.contacts.number))}},this.props.tour.contacts&&this.props.tour.contacts.number),S.a.createElement(li,{onClick:function(){return window.open("mailto:".concat(t.props.tour.contacts&&t.props.tour.contacts.email))}},this.props.tour.contacts&&this.props.tour.contacts.email))),this.props.tour.config&&this.props.tour.config.enableRibbon?S.a.createElement("div",null,this.props.tour&&this.props.tour.theme&&"classic"===this.props.tour.theme?S.a.createElement("div",null,this.lastImage.bind(this)()?null:S.a.createElement(mi,{large:!0,reelvisible:this.props.reelVisible?1:0,onClick:this.selectNextImage.bind(this),disabled:this.state.isDisabledControls}),this.firstImage.bind(this)()?null:S.a.createElement(hi,{large:!0,reelvisible:this.props.reelVisible?1:0,onClick:this.selectPreviousImage.bind(this),disabled:this.state.isDisabledControls}),this.props.vr?null:S.a.createElement(di,{visible:this.props.reelVisible},S.a.createElement(pi,{reelvisible:this.props.reelVisible,onClick:this.props.toggleReel}),S.a.createElement(vi,{visible:this.props.reelVisible},this.props.tour.images&&Object(B.getViewerRibbonImages)(this.props.tour.images).map((function(e){return S.a.createElement(wi,{key:e.id,isDisabled:t.state.isDisabledControls},S.a.createElement(yi,{active:t.props.selectedImage&&e.url===t.props.selectedImage.url},S.a.createElement(xi,null,S.a.createElement(Ci,{icon:O.a})),S.a.createElement(bi,{disabled:t.state.isDisabledControls,onClick:function(){return t.setScene(e)},src:e.thumbUrl||e.url,alt:""})),S.a.createElement(gi,null,e.title))}))))):this.props.vr?null:S.a.createElement(Hn,y()({},this.props,{setScene:this.setScene.bind(this),selectNextImage:this.selectNextImage.bind(this),selectPreviousImage:this.selectPreviousImage.bind(this),lastRoom:this.lastImage.bind(this)(),firstRoom:this.firstImage.bind(this)()}))):null,!this.props.preview||this.props.preview&&B.mobileNavigator?S.a.createElement("div",{style:{height:"100%",width:"100%",left:0,top:0,position:"fixed",backgroundColor:"black",cursor:"-webkit-grab"},ref:this.setPanoRef.bind(this)}):S.a.createElement("div",{style:{height:this.props.height?this.props.height:"70vh",width:this.props.width?this.props.width:"70vw",position:"fixed",cursor:"-webkit-grab"},ref:this.setPanoRef.bind(this)}),S.a.createElement("div",null,S.a.createElement(D.a,y()({},this.props,{closeModal:this.handleHtmlInfospotCloseByClick.bind(this),noPageHeader:!0}),S.a.createElement("div",null,this.props.selectedInfospot&&this.props.selectedInfospot.data&&("image"===this.props.selectedInfospot.dataType?S.a.createElement("div",{dangerouslySetInnerHTML:{__html:'<div style="object-fit:contain; text-align: center;">\n                    <img src="'.concat(this.props.selectedInfospot.data.image&&this.props.selectedInfospot.data.image.thumbUrl,'" />\n                    <br>\n                    <span>\n                      ').concat(this.props.selectedInfospot.data.caption,"\n                    </span>\n                      </div>")}}):S.a.createElement("div",{dangerouslySetInnerHTML:{__html:'<div style="object-fit:contain;">'.concat((e=this.props.selectedInfospot.data,"string"==typeof e?e:R()(e,"htmlContent",null)||""),"</div>")}}))))),S.a.createElement(qt.a,y()({},this.props,{isTourViewerPage:!0,setScene:this.setScene.bind(this)})),S.a.createElement(L.a,y()({},this.props,{noPageHeader:!0})),S.a.createElement(z.a,{height:"auto",in:"shareAndEmbed"===this.props.modal,closeModal:this.props.closeModal,onRequestClose:2===Object(B.User)().type?this.props.exitPaid(this.props.tour,this.props.viewerStr.savingTheTourPleaseWait):this.props.exitFree,buttonOneAction:2===Object(B.User)().type?this.props.exitPaid(this.props.tour,this.props.viewerStr.savingTheTourPleaseWait):this.props.exitFree,buttonOneText:this.props.commonStr.exit,buttonTwoAction:2===Object(B.User)().type?this.props.exitPaid(this.props.tour,this.props.viewerStr.savingTheTourPleaseWait):this.props.exitFree,buttonTwoText:this.props.commonStr.viewTour,noPageHeader:!0},S.a.createElement(Bt.a,{user:this.props.user,tour:this.props.tour,showNotification:this.props.showNotification,path:this.props.modalMeta&&"/tours/".concat(this.props.modalMeta.shortId),noPageHeader:!0})),S.a.createElement(Si.a,{in:!this.props.preview&&("payments"===this.props.modal||"branding"===this.props.modal),tour:this.props.tour,closeModal:this.props.closeModal,finishAction:this.props.finishAction,startAction:this.props.startAction,showNotification:this.props.showNotification,openShareAndEmbed:function(){return t.props.openShareAndEmbed(t.props.tour)},user:this.props.user,setUser:this.props.setUser,setTour:this.props.setTour,noPageHeader:!0,setStripeTokens:this.handleSetTokens,openModal:this.props.openModal}),S.a.createElement(ki.a,y()({in:"pro-plus-trial"===this.props.modal,tour:this.props.tour,setTour:function(e){return t.props.setTour(y()({},t.props.tour,{type:e}))},stripeTokens:this.state.stripeTokens,openShareAndEmbed:function(){return t.props.openShareAndEmbed(t.props.tour)}},this.props)),S.a.createElement(zn.a,y()({},this.props,{noPageHeader:!0})),S.a.createElement(ro,y()({},this.props,{isDisabled:this.state.isDisabledControls,isHide:this.state.isHideTourViewerControls})),this.props.preview?null:S.a.createElement(Io,{title:this.props.viewerStr.upgradeToRemoveThisWatermark,show:this.props.tour.type&&"free"==this.props.tour.type,onClick:function(){return window.open("https://www.cloudpano.com")}},this.props.viewerStr.madeFreeAndEasyWith," ",S.a.createElement(So,null,"CloudPano")),S.a.createElement(Un.a,y()({},this.props,{tour:this.props.tour,showNotification:this.props.showNotification,path:"",noPageHeader:!0}))),S.a.createElement(Co,{percent:this.props.imageLoadingProgress}),S.a.createElement(Fn.a,this.props)):S.a.createElement("div",null,S.a.createElement(L.a,y()({},this.props,{noPageHeader:!0})),S.a.createElement(Mn.a,y()({},this.props,{onValid:function(){t.props.setPasswordEnteredAndValid(),t.runMountingActivities()},noPageHeader:!0})))}}]),s}(S.a.PureComponent),fo=Object(k.keyframes)(["0%{opacity:1;z-index:1;transform:scale(0.001);}10%{opacity:1;z-index:1;transform:scale(1);}95%{opacity:1;z-index:1;transform:scale(1);}99%{opacity:1;z-index:1;transform:scale(.001);}100%{z - index:-5;transform:scale(0.001);}"]),go=k.default.div.withConfig({displayName:"TourViewer__RotateWrapper",componentId:"oodlia-0"})(["position:absolute;text-align:center;width:10em;top:30%;left:0;right:0;margin-left:auto;margin-right:auto;color:white;opacity:0;animation:"," 3s linear;"],fo),wo=k.default.img.withConfig({displayName:"TourViewer__RotateMobileImage",componentId:"oodlia-1"})(["width:10em;"]),bo=k.default.img.withConfig({displayName:"TourViewer__RotateDesktopImage",componentId:"oodlia-2"})(["width:10em;"]),vo=function(e){return e.logo&&e.logo.length>1?S.a.createElement(ri,{src:e.logo}):null},yo=Object(k.default)(_.a).withConfig({displayName:"TourViewer__LoadingSpinner",componentId:"oodlia-3"})(["position:absolute;left:50%;top:40%;font-size:4em;color:",";"],pe.actionColor),xo=k.default.div.withConfig({displayName:"TourViewer__Wrapper",componentId:"oodlia-4"})(["@media screen and (max-width:","){height:100%;width:100%;overflow:none;display:block;position:fixed;}",";"],B.mobileWidth,(function(e){return e.styles})),Co=k.default.div.withConfig({displayName:"TourViewer__ProgressLoadingBar",componentId:"oodlia-5"})([""," height:5px;position:absolute;top:0;background:white;-webkit-transition:opacity 0.5s ease;transition:opacity 0.5s ease;",";"],(function(e){var t=e.percent;return t&&"width: ".concat(t+"%",";")}),(function(e){return 100==e.percent&&"opacity:0;"})),Io=k.default.div.withConfig({displayName:"TourViewer__Watermark",componentId:"oodlia-6"})(["background:rgba(20,20,20,0.5);position:absolute;width:200px;left:50%;top:0;margin-left:-100px;z-index:0;color:white;font-family:'Lato',sans-serif;font-size:10px;text-align:center;cursor:pointer;border-radius:0 0 0.5em 0.5em;display:none;",";"],(function(e){return e.show&&"display:unset;"})),So=k.default.div.withConfig({displayName:"TourViewer__CloudPanoText",componentId:"oodlia-7"})(["font-family:'Pacifico',cursive;font-size:1rem;"]);t.default=Object(E.connect)(lo,po)(ho)}}]);